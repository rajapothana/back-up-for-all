/*
** Copyright Â© 2018 Apple Inc.
** All rights reserved.
*/

its.kit.createController("iTSMoreText",{binding:".more-text",component:{init:function(){var e=this.element;
if(e.hasClassName("more-text")){var t=e.getAttribute("truncate-style"),n=parseInt(e.getAttribute("truncate-length"),10),r=e.getAttribute("truncate-override")=="true";
this.setOptions(t,n,r)}},setOptions:function(e,t,n){this.showType=e,this.showLines=t,this.overrideLink=n;
switch(this.showType){case"paragraph":this.truncateParagraph();
break;case"same-paragraph":this.truncateSameParagraph();
break;case"inline":this.truncateInline();
break;case"multi-paragraph":this.truncateMultiParagraph();
break;case"list":this.truncateList();
break;case"mixed":this.truncateMixed()}},moreLinkClicked:function(e){e.stopPropagation(),e.preventDefault();
switch(this.showType){case"paragraph":this.showAllParagraph();
break;case"inline":this.showAllInline();
break;case"multi-paragraph":this.showAllMultiParagraph();
break;case"list":this.showAllList();
break;case"mixed":this.showAllMixed();
break;default:this.showAllParagraph()}},truncateParagraph:function(){var e=this.element,t=this.paragraphLineClamp();
t<100&&(e.parentNode.querySelector("p ~ a.goto-link")||(this.moreLink=this.createMoreLink(),this.listen(this.moreLink,"click","moreLinkClicked"),e.insertAfter(this.moreLink)),e.style.display="-webkit-box",e.style.webkitBoxOrient="vertical",e.style.overflow="hidden",e.style.webkitLineClamp=t+"%")},truncateMultiParagraph:function(){var e=this.element.querySelectorAll("p").length>1,t=e?99:this.paragraphLineClamp();
t<100&&this.element.tagName=="DIV"&&this.element.querySelectorAll("p").each(function(e,n){n>0?e.hide():(this.moreLink=this.createMoreLink(),this.listen(this.moreLink,"click","moreLinkClicked"),e.insertAfter(this.moreLink),e.style.display="-webkit-box",e.style.webkitBoxOrient="vertical",e.style.overflow="hidden",e.style.webkitLineClamp=t+"%")},this)},truncateInline:function(){var e=this.element.querySelectorAll("p");
if(e.length>0)e.each(function(e,t){t>0?e.hide():e.lineCount()>this.showLines&&this._truncateInlineHelper(e)},this);
else{var t=this.element.querySelector(".truncate");
t||(t=this.element.firstElementChild),t&&Math.floor(t.lineCount())>this.showLines&&this._truncateInlineHelper(t)}},_truncateInlineHelper:function(e){if(this.element.getComputedStyleProperty("position")=="static"){var t=this.element.parentByClassName("wide-user-lockup");
t||(this.element.style.position="relative")}e.insertAfter(this.createMoreLink()),this.moreLink=e.parentNode.querySelector("a.more-link"),this.listen(this.moreLink,"click","moreLinkClicked"),e.style.display="-webkit-box",e.style.webkitBoxOrient="vertical",e.style.overflow="hidden",e.style.webkitLineClamp=Math.ceil(this.showLines/e.lineCount()*100)+"%";
var n=this.createMoreLink();
n.className="more-link-placeholder",e.appendChild(n)},truncateSameParagraph:function(){var e=this.showLines/this.element.lineCount()*100;
e<100&&(this.element.parentNode.querySelector("p ~ a.goto-link")||(this.element.parentNode.insertBefore(this.createMoreLink(),null),this.moreLink=this.element.parentNode.querySelector("a.more-link"),this.listen(this.moreLink,"click","moreLinkClicked")),this.element.style.display="-webkit-box",this.element.style.webkitBoxOrient="vertical",this.element.style.overflow="hidden",this.element.style.webkitLineClamp=this.showLines)},paragraphLineClamp:function(){return this.element.tagName!="DIV"?(this.showLines+1)/this.element.lineCount()*100:(this.showLines+1)/this.element.querySelector("p").lineCount()*100},showAllParagraph:function(){this.overrideLink||(this.element.style.webkitLineClamp="100%"),!this.overrideLink&&this.moreLink&&this.moreLink.hide()},showAllInline:function(){if(this.element.querySelectorAll("p").length>0)this.showAllMultiParagraph();
else{var e=this.element.querySelector(".truncate");
e||(e=this.element.firstElementChild),e.style.webkitLineClamp="100%",!this.overrideLink&&this.moreLink&&this.moreLink.hide()}},showAllMultiParagraph:function(){this.overrideLink||(this.element.querySelector("p").style.webkitLineClamp="100%"),this.overrideLink||this.element.querySelectorAll("p").each(function(e){e.show()}),!this.overrideLink&&this.moreLink&&this.moreLink.hide()},showAllMixed:function(){this.moreLink.hide();
var e=this.element.querySelector(".fixed-truncate-area");
e&&(e.style.height="",e.style.overflow=""),this.element.querySelectorAll("p, li, ul").show(),this.element.querySelectorAll("li").each(function(e){e.style.height=""})},truncateList:function(){var e=this.showLines-1;
if(this.element.children.length>e+2){this.element.children.each(function(t,n){n>e&&t.hide()});
var t=document.createElement("li");
t.appendChild(this.createMoreLink()),this.element.children[e].insertAfter(t),this.moreLink=this.element.querySelector("a.more-link"),this.listen(this.moreLink,"click","moreLinkClicked")}},adjustHeight:function(){var e=this.element.querySelectorAll("p, ul"),t=0,n=!1;
if(e.length>0)var r=e[0].getComputedStyleProperty("line-height").toInt(),i=this.showLines*r;
for(var s=0;
s<e.length;
s++){var o=e[s],u=o.offsetHeightPlusMargin()+o.paddingHeight();
if(n)o.hide();
else if(t+u<=i)t+=u;
else{var a=o;
o.tagName=="UL"&&o.querySelectorAll("li").each(function(e){if(n)e.hide();
else{var r=e.offsetHeightPlusMargin()+e.paddingHeight();
t+r>i?(a=e,n=!0):t+=r}}),n=!0,t+=a.getComputedStyleProperty("margin-top").toInt()+a.getComputedStyleProperty("padding-top").toInt();
var f=0;
for(var l=0;
l<a.lineCount();
l++){if(!(t+(l+1)*r<i))break;f++}f==0?a.hide():(a.style.webkitBoxOrient="vertical",a.style.overflow="hidden",a.tagName=="LI"?a.style.height=r*f+"px":a.style.webkitLineClamp=f/a.lineCount()*100+"%")}}var c=this.element.querySelector(".fixed-truncate-area");
if(c){if(!n){var h=this.createMoreLinkDiv();
h.style.visibility="hidden",this.element.appendChild(h)}c.style.height=i+"px",c.style.overflow="hidden"}return n},truncateMixed:function(){this.showLines++;
var e=this.adjustHeight();
this.element.style.display="-webkit-box",this.element.style.webkitBoxOrient="vertical",this.element.style.overflow="hidden",e&&(this.element.appendChild(this.createMoreLinkDiv()),this.moreLink=this.element.querySelector("a.more-link"),this.listen(this.moreLink,"click","moreLinkClicked"))},showAllList:function(){this.moreLink.parentByTagName("li").remove(),this.element.children.show()},createMoreLinkDiv:function(){var e=document.createElement("div");
return e.appendChild(this.createMoreLink()),e},createMoreLink:function(){var e=document.createElement("a");
return e.className="more-link",e.href="#more-link",e.setAttribute("ontouchstart",""),e.innerText=its.loc("Js.TextTruncation.More"),e}}}),its.kit.createController("SfTextTruncate",{binding:"*[data-text-truncate-lines]",component:{init:function(){if(its.client.screenReaderRunning()){this.element.addClassName("data-text-truncate-opened");
return}this.linesToShow=this.element.getAttribute("data-text-truncate-lines");
switch(this.element.tagName){case"P":this.truncateType=this.types.paragraph,this.initForSingleParagraph();
break;case"UL":case"OL":this.truncateType="list",this.initForList();
break;default:console.log("Unsupported Truncation Type")}},types:{paragraph:"sf-text-truncate-paragraph",list:"sf-text-truncate-list"},createMoreLink:function(e){var t,n=document.createElement("a");
return n.className=e,n.href="#more-link",n.setAttribute("ontouchstart",""),n.innerText=this.locKey("More"),n},locKey:function(e){return its.loc(e)},initForSingleParagraph:function(){var e=this.paragraphIsTruncated(this.element);
e&&!this.moreLink&&(this.element.appendChild(this.createMoreLink("text-truncate-toggle")),this.moreLink=this.element.querySelector("a.text-truncate-toggle:not(.placeholder)"),this.moreLink.addEventListener("click",bind(this,"singleLineParagraphToggle"),!1),this.moreLink.setAttribute("aria-hidden","true"))},paragraphIsTruncated:function(e){var t=getComputedStyle(e);
return parseInt(t.getPropertyValue("height"),10)<e.scrollHeight},singleLineParagraphToggle:function(e){e.preventDefault(),this.opened?(this.element.removeClassName("data-text-truncate-opened"),this.opened=!1,this.moreLink.innerText=this.locKey("More")):(this.element.addClassName("data-text-truncate-opened"),this.opened=!0,this.moreLink.innerText=this.locKey("Less"))},initForList:function(){if(!this.moreLink)return;var e=this.element.children;
cutoffIndex=this.linesToShow-1;
if(e.length>cutoffIndex+2){for(var t=cutoffIndex;
t<e.length;
t++)e[t].style.display="none";
this.moreLinklistItem=document.createElement("li"),this.moreLink=this.createMoreLink("text-truncate-toggle"),this.moreLink.setAttribute("aria-hidden","true"),this.moreLinklistItem.appendChild(this.moreLink),e[cutoffIndex].insertAfter(this.moreLinklistItem),this.listen(this.moreLink,"click","singleLineListToggle")}},singleLineListToggle:function(){var e=this.element.children;
this.moreLinklistItem.remove();
for(var t=0;
t<e.length;
t++)e[t].style.display="inherit"}}}),Element.prototype.replaceTokenWithElement=function(t,n){return its.Template.replaceTokenWithElement(this,t,n)},its.Template=Class.create("its.Template",{initialize:function(t,n){its.Logger&&(this._logger=its.Logger.named("its.Template")),this._stopwatch=ITSStopwatch?ITSStopwatch.named("its.Template"):null,this._parent=null,this.rootParent=this,this._logger&&this._logger.debug("creating template: "+n),t=its.string.trim(t);
if(its.string.startsWith(t,"<script",!0)){var r=null;
r=this._createElementRepresentationOfTemplateString(t,!0),r.nodeName=="SCRIPT"&&r.id&&(t=r.innerHTML,n||(n=r.id))}if(!n)throw"new its.Template(...) called without required uniqueTemplateName parameter";
this._rawTemplateString=t,this._name=n,this._tokens={},this._elementTokens={},this._blocks={},this._blocksToKeep={},this._parsedChunks=[],this._parsedRefs={},this._nextIterations=[],this._repetitionId=1,its.Template._cache[this._name]=this,this.dateFormatter="%b %e",its.Template.disableOnDemandParsing&&this._parseIfNeeded()},parent:function(){return this._parent},rootParent:function(){return this.rootParent},isChild:function(){return this.parent()?!0:!1},name:function(){return this._name},_nameWithRepetitionId:function(){var t=this.isChild()?this._repetitionId:"";
return its.Template.namespacedString(this.name(),t)},fullTokenName:function(t){return its.contains(t,its.Template.namespaceSeparator)?t:its.Template.namespacedString(this._nameWithRepetitionId(),t)},replaceToken:function(e,t,n,r){var i=this;
if(typeof n=="undefined"||n){var s=its.string.xmlEscape(t);
i=this.replaceTokenUnescaped(e,s,n);
if(this._logger&&this._logger.isAnyDebugLevel()&&r!=its.Template.SUPPRESS_WARNINGS&&t!=s&&t&&its.isString(t)&&t.match(/<[^>]*>/))try{throw new Error}catch(o){this._logger.warn("\n**********\n MARKUP FOUND:\n**********\nreplaceToken("+e+"): Found HTML markup in replacement value: "+t+"\n==========\n STACKTRACE:\n==========\n"+o.stack)}}return i},replaceTokenUnescaped:function(e,t,n){return typeof n!="undefined"&&!n?this:(this._parseIfNeeded(),this._tokens[e]=t,this)},replaceObject:function(e,t){return this._replaceObjectFunnel(e,t,!0)},replaceObjectUnescaped:function(e,t){return this._replaceObjectFunnel(e,t,!1)},_replaceObjectFunnel:function(refName,refObj,escape){this._parseIfNeeded();
var refTokens=this.rootParent._parsedRefs[refName];
if(!refTokens)throw"replaceObject('"+refName+"') called on template with no object tokens";
var obj={};
obj[refName]=refObj;
for(var index=0;
index<refTokens.length;
index++){var token=refTokens[index],val=null;
try{val=eval("obj."+token)}catch(e){}val!=null&&(escape?this.replaceToken(token,val):this.replaceTokenUnescaped(token,val))}return this},replaceTokenWithElement:function(e,t,n){if(!t)return;return typeof n!="undefined"&&!n?this:(this._parseIfNeeded(),this._elementTokens[this.fullTokenName(e)]=t,this)},elementAssociatedWithToken:function(e){return this._parseIfNeeded(),this._elementTokens[e]},replaceBlock:function(e,t){return this._parseIfNeeded(),this._blocks[e].value=t,this},keepBlock:function(e,t){return arguments.length<2&&(t=!0),t?(this._parseIfNeeded(),e=its.Template.leafName(e),this._blocksToKeep[e]=!0):this._blocksToKeep[e]=!1,this},_ancestorFlaggedToKeep:function(e){var t=null,n=this.parent();
while(n&&t==null){var r=n._blocksToKeep[e];
its.isDefined(r)?t=r:n=n.parent()}return t},getBlock:function(e,t){var n=its.Template.named(e);
return n||(n=this._getBlockRecursive(e)),!n&&this._logger&&!t&&this._logger.error("getBlock(): Failed to find block: '"+e+"' at any level of template: '"+this.name()+"'"),n},_getBlockRecursive:function(e){this._parseIfNeeded();
var t=this._blocks[e],n=t?t.template:null;
if(!n)for(var r in this._blocks){var i=this._blocks[r].template;
i&&(its.string.endsWith(i._name,e)?n=i:n=i._getBlockRecursive(e));
if(n)break}return n},next:function(e){this._parseIfNeeded(),this._copyElementTokensToRootParent();
var t=this._composeToString();
return this._nextIterations.push(t),e&&this._nextIterations.push(e),this._reset(),this._repetitionId++,t},compose:function(e,t){if(its.reflect.hasAnyNonNullKeys(this._elementTokens))throw"'"+this.name()+'\' template: attempt made to compose a template to a string after replacing tokens with live DOM elements. Try using "composeAsElement()" instead.';
return this._compose(e,t,!0)},_compose:function(e,t,n){this._parseIfNeeded();
var r=!1,i=null;
if(this._isITML()&&this._tokens.itsId){var i=e?e:its.Template.createItsId();
this.replaceToken(e,'itsId="'+i+'"'),r=!0}var s;
this._copyElementTokensToRootParent(),this._nextIterations.length==0?s=this._composeToString():s=this._nextIterations.join(""),this._isITML()&&(r?s.itsId||(s=new String(s),s.itsId=function(){return i}):s=its.Template.addItsIdToComposedString(s,e)),this._nextIterations=[],n&&this._reset();
if(t){var o=this._elem(t);
this._isITML()?o.innerXML=s:o.innerHTML=s,its.Template.queryForITSElements(o)}return s},_createElementRepresentationOfTemplateString:function(e,t){var n=null,r=its.element.createDocumentFragmentFromString(e),i=r[its.Template.firstElementChild];
return r[its.Template.children].length!=1||!t&&(i instanceof HTMLScriptElement||i.tagName.toLowerCase()=="placeholder")?n=r:n=i,this._isITML()&&(e.itsId||this._logger.debug(["---------- missing itsId method on composed template string: ",e]),e.itsId()&&(n.itsId=function(){return e.itsId()})),n},composeAsElement:function(e){its.Template.composeAsElementCalls++,this._parseIfNeeded();
var t=null,n=this._compose(e,null,!1);
t=this._createElementRepresentationOfTemplateString(n);
if(t){var r=this;
t.__creatorTemplate=Class.shallowClone(this),t.replaceTokenWithElement=this._elementReplaceTokenWithElement,this._applyStashedElementTokens(t),t instanceof DocumentFragment&&(t.___stashedChildNodes=this._shallowCloneNodeList(t[its.Template.children]),t[its.Template.children].length==1&&!(t[its.Template.firstElementChild]instanceof HTMLScriptElement)&&t[its.Template.firstElementChild].tagName.toLowerCase()!="placeholder"&&(t=t[its.Template.firstElementChild]))}else this._logger&&this._logger.error("composeAsElement failed to create new element with this html:"+n,null,!0);
return this._reset(),this._isITML()&&t instanceof Element&&document.appendChild(t.parentNode),t},composeAndAppend:function(e,t){this._parseIfNeeded();
var n=this.composeAsElement(),r=this._elem(e);
return t?r.insertBefore(n,t):r.appendChild(n),n},composeAndReplace:function(e){this._parseIfNeeded();
var t=this.composeAsElement(),n=this._elem(e);
return n.parentNode.replaceChild(t,n),t},_elem:function(e){return typeof e=="string"?document.querySelector(e):e},_copyElementTokensToRootParent:function(){if(this.rootParent!=this)for(var t in this._elementTokens){var n=this.fullTokenName(t);
its.isDefined(this.rootParent._elementTokens[n])||(this.rootParent._elementTokens[n]=this._elementTokens[t])}},_getValue:function(e,t){var n=null;
this._parseIfNeeded();
if(t=="elementToken"){var r=this.fullTokenName(e),i=this._isITML()?"placeholder":"SCRIPT";
n="<"+i+' _ph="'+r+'"></'+i+">"}else{var s=this._tokens[e];
s==null&&this.isChild()?s=this.parent()._getValue(e):s==null?s=s?s:"":s instanceof Date?s=s.format(this._getDateFormatter()):s+="",n=s}return n},_getDateFormatter:function(){this._parseIfNeeded();
var e=this.dateFormatter;
return!this.dateFormatter&&this.isChild()&&(e=this.parent()._getDateFormatter()),e},_reset:function(){this._parseIfNeeded();
var e;
for(e in this._tokens)this._tokens[e]=void 0;
return this._elementTokens={},this._blocksToKeep={},this},_composeToString:function(){this._parseIfNeeded();
var e=[],t=null,n="";
for(var r=0;
r<this._parsedChunks.length;
r++){t=this._parsedChunks[r],n="";
if(typeof t=="string")n=t;
else if(t.type=="token")n=this._tokens[t.name],n==null&&(n=this._getValue(t.name,t.subtype));
else if(t.type=="block"){var i=this._blocksToKeep[t.name],s=its.isDefined(i);
s&&i||!s&&this._ancestorFlaggedToKeep(t.name)==1||t.template._nextIterations.length>0?n=t.template._compose(null,null,!0):n=""}e.push(n)}return e.join("")},_parseIfNeeded:function itsTemplate_parse(){if(!this._rawTemplateString)return;var stack=[this],match,embedString=null,currTemplate=null;
while((match=its.Template.REGEX.exec(this._rawTemplateString))!=null){var leftContext=match.input.substr(0,match.index),rightContext=match.input.substr(match.index+match[0].length);
currTemplate=stack[stack.length-1],embedString=null,currTemplate._parsedChunks.push(leftContext);
var chunk={},val=RegExp.lastMatch,chunkSubtype=null;
val.indexOf("@")==0?(chunkSubtype="basicToken",chunk.name=match[its.Template._PATTERN.BASIC.position],currTemplate._tokens[chunk.name]=null):val.indexOf("$")==0&&(chunkSubtype="elementToken",chunk.name=match[its.Template._PATTERN.ELEMENT.position]);
if(chunkSubtype){chunk.type="token",chunk.subtype=chunkSubtype,currTemplate._parsedChunks.push(chunk);
var index;
if((index=chunk.name.indexOf("."))>0){var refName=chunk.name.substring(0,index),refTokens=this._parsedRefs[refName];
refTokens==null&&(refTokens=[],this._parsedRefs[refName]=refTokens),refTokens.push(chunk.name)}}else if(val.indexOf("@/")==-1){chunk.name=match[its.Template._PATTERN.BLOCK.position];
var uniqueTemplateName=its.Template.namespacedString(currTemplate.name(),chunk.name),template=new its.Template(null,uniqueTemplateName);
chunk.type="block",chunk.template=template,currTemplate._parsedChunks.push(chunk),currTemplate._blocks[chunk.name]={template:template},template.rootParent=this,template._parent=currTemplate,stack.push(template)}else val.indexOf("#embed:")==0?embedString=eval(match[its.Template._PATTERN.EMBED.position]):val.indexOf("#js:")==0?this._parsedChunks.push(eval(match[its.Template._PATTERN.JS.position])):stack.length--;
this._rawTemplateString=rightContext,embedString!=null&&(this._rawTemplateString=embedString+this._rawTemplateString)}this._parsedChunks.push(this._rawTemplateString),this._rawTemplateString=null},_applyStashedElementTokens:function(t){for(var n in this._elementTokens)if(this._elementTokens.hasOwnProperty(n)){var r=this._elementTokens[n];
r&&t.replaceTokenWithElement(n,r)}},_elementReplaceTokenWithElement:function(t,n){var r=this.__creatorTemplate.fullTokenName(t),i=this;
if(this.___realParentElement)i=this.___realParentElement;
else if(this.___stashedChildNodes&&this.___stashedChildNodes.length&&(!this[its.Template.children]||!this[its.Template.children].length))for(var s=0;
s<this.___stashedChildNodes.length;
s++){this.___stashedChildNodes[s]||this.printITML();
var o=this.___stashedChildNodes[s].parentNode;
if(o){i=o,this.___realParentElement=i,this.___realParentElement.__replacedTokens?its.reflect.copyKeysAndValues(this.__replacedTokens,this.___realParentElement.__replacedTokens):this.___realParentElement.__replacedTokens=this.__replacedTokens;
break}}return its.Template.replaceTokenWithElement(i,r,n)},_shallowCloneNodeList:function(e){var t;
if(this._isITML()){t=[],t.item=function(e){return this[e]};
for(var n=0;
n<e.length;
n++)e.item(n)&&t.push(e.item(n))}else t=Class.shallowClone(e);
return t},_isITML:function(){return its&&its.sf&&its.sf.Platform&&its.sf.Platform.isITML()}}),its.Template.Events={NEW_ELEMENTS_CREATED:"its.Template.Events.NEW_ELEMENTS_CREATED"},its.Template._queriedIds={},its.Template.queryForITSElements=function(e){var t;
e?t=e:its.isDefined(window.currentDocument)&&window.currentDocument()?t=this.currentDocument().documentElement:document&&(t=document),t.querySelectorAll||(t=t.parentNode);
if(t){var n=t.querySelectorAll("[itsId]");
for(var r=0;
r<n.length;
r++){var i=n[r],s=i.getAttribute("itsId");
this._queriedIds[s]||(this._queriedIds[s]=!0,its.notifications.publishToTarget(its.Template.Events.NEW_ELEMENTS_CREATED,{target:i,itsId:s},s))}}},its.Template.addItsIdToComposedString=function(e,t){var n=e,r=t?t:its.Template.createItsId(),i=/(<\s*)(.*?)\W/,s=i.exec(e),o=s?s[2]:null,u=e.indexOf(o+" itsId")>=0;
return u?r=n.match(/itsId\s*\=\s*\"(\w*)\"/)[1]:o&&(n=new String(e.replace(o,o+" itsId="+'"'+r+'"'))),n.itsId||(n=new String(n),n.itsId=function(){return r}),n},its.Template.namespaceSeparator=".",its.Template._PATTERN={BASIC:{position:0,pattern:"@([a-zA-Z0-9_\\-.]+)@"},ELEMENT:{position:0,pattern:"\\$([a-zA-Z0-9_\\-.]+)\\$"},BLOCK:{position:0,pattern:"<!-- +@\\/?([a-zA-Z0-9_\\-.]+)@ +-->"},EMBED:{position:0,pattern:"#embed:([a-zA-Z0-9_\\-.]+)"},JS:{position:0,pattern:"#js:(.*?)#"}},its.Template.createItsId=function(){var e=0;
return function(){var t="itsId"+e;
return e++,t}}(),its.Logger&&(its.Template._logger=its.Logger.named("its.Template")),its.Template._PATTERNS_STRING=function(){var t="",n=1;
for(var r in its.Template._PATTERN)its.Template._PATTERN.hasOwnProperty(r)&&(its.Template._PATTERN[r].position=n,t.length&&(t+="|"),t+=its.Template._PATTERN[r].pattern,n++);
return t}(),its.Template.REGEX=new RegExp(its.Template._PATTERNS_STRING),its.Template._cache={},its.Template.disableOnDemandParsing=!1,its.Template.SUPPRESS_WARNINGS=!0,its.Template.create=function(e){var t=document.getElementById(e),n=its.Template.named(e);
if(n)return n;
var r=t?t.innerHTML:null;
if(!r)throw"its.Template : Unable to find template with id: "+e;
return its.Template.createFromString(r,e)},its.Template.createFromString=function(e,t){var n=its.Template.named(t);
return n==null&&(n=new its.Template(e,t)),n},its.Template.resetAllCachedTemplates=function(){for(var e in its.Template._cache){var t=its.Template._cache[e];
t._reset()}},its.Template.named=function(t){return its.Template._cache[t]},its.Template.replaceTokenWithElement=function(t,n,r,i){if(!r)return;if(typeof i!="undefined"&&!i)return this;
var s='[_ph="'+n+'"]',o=t.querySelector(s);
if(!o&&t.__replacedTokens){var u=t.__replacedTokens[n];
if(u&&u.length){for(var a=0;
a<u.length;
a++)o?u[a].remove():o=u[a];
t.__replacedTokens&&(t.__replacedTokens[n]=null)}}if(!o){var c="";
throw its.contains(n,its.Template.namespaceSeparator)||(c=" It looks like you forgot to fully qualify the token name, like: main_template_name."+n+" or main_template_name.SomeBlock."+n+" etc."),new Error("replaceTokenWithElement(): Attempting to replace non-existent elementToken: '"+n+"'."+c)}var f=[];
if(r.nodeType&&r.nodeType==11){var l=r.childNodes;
for(var a=0;
a<l.length;
a++)l.item(a)&&f.push(l.item(a))}else f.push(r);
return t.__replacedTokens||(t.__replacedTokens={}),t.__replacedTokens[n]=f,o.parentNode&&(o.ownerDocument&&o.ownerDocument!=r.ownerDocument&&(typeof r=="string"||r instanceof String?this._logger.error(["---------- Replacement element was a string: ",r.toString()]):o.ownerDocument.adoptNode(r)),r!=o&&o.parentNode.replaceChild(r,o)),this},its.Template.leafName=function(t){var n=t.split(its.Template.namespaceSeparator),r=n[n.length-1];
return r},its.Template.namespacedString=function(t,n,r){var i="";
if(arguments)for(var s=0;
s<arguments.length;
s++){var o=arguments[s];
o&&o!=""&&(i==""?i=o:i=i+its.Template.namespaceSeparator+o)}return i},its.Template.composeAsElementCalls=0,its.Template.children=its&&its.sf&&its.sf.Platform&&its.sf.Platform.isITML()?"children":"childNodes",its.Template.firstElementChild=its&&its.sf&&its.sf.Platform&&its.sf.Platform.isITML()?"firstElementChild":"firstChild",window.its||(window.its={}),window.its.sf||(window.its.sf={}),its.sf.PurchasesUtil={NO_CONTENT_MESSAGE_MAP:{normal:{self:{music:"Purchases.NoContent.Music.Download_message",movies:"Purchases.NoContent.Movies.Download_message",tvShows:"Purchases.NoContent.TVShows.Download_message",mobileSoftware:"Purchases.NoContent.MobileSoftware.Download_message",eBooks:"Purchases.NoContent.EBooks.Download_message",audiobooks:"Purchases.NoContent.Audiobooks.Download_message"},member:{music:"Purchases.NoContent.Member.Music.Download_message",movies:"Purchases.NoContent.Member.Movies.Download_message",tvShows:"Purchases.NoContent.Member.TVShows.Download_message",mobileSoftware:"Purchases.NoContent.Member.MobileSoftware.Download_message",eBooks:"Purchases.NoContent.Member.EBooks.Download_message",audiobooks:"Purchases.NoContent.Member.Audiobooks.Download_message"}},hidden:{self:{music:"Purchases.NoContent.Music.Hidden_message",movies:"Purchases.NoContent.Movies.Hidden_message",tvShows:"Purchases.NoContent.TVShows.Hidden_message",mobileSoftware:"Purchases.NoContent.MobileSoftware.Hidden_message",eBooks:"Purchases.NoContent.EBooks.Hidden_message",audiobooks:"Purchases.NoContent.Audiobooks.Hidden_message"},member:{}}},setSelectedSPMember:function(e){this._selectedSPMember=e},getSelectedSPMember:function(){return this._selectedSPMember},noContentMessageGenerator:function(e,t,n,r){var i=its.sf.PurchasesUtil.NO_CONTENT_MESSAGE_MAP[e][t][n],s={};
return r&&(s.displayName=r),its.loc(i,s)},iOSSpBannerMessageForKey:function(e){var t="iTunes.openURL('prefs:root=CASTLE&path=FAMILY')";
return this._commonSpBannerMessageForKey(e,t)},desktopSpBannerMessageForKey:function(e){var t="iTunes.launchiCloudFamilySettings()";
return this._commonSpBannerMessageForKey(e,t)},_commonSpBannerMessageForKey:function(e,t){var n={},r=this.createMessageLinkElement(its.loc("Purchases.NotConfigured.LinkLabel"),t);
n.iCloudLink=r;
var i,s;
return e=="Purchases.AccountsMismatched.Message"?(i=its.loc("Purchases.AccountsMismatched.LearnMoreLink"),s=its.loc("Purchases.AccountsMismatched.LearnMoreLinkLabel")):e=="Purchases.AccountsMismatched.Message.WithAccount"?(i=its.loc("Purchases.AccountsMismatched.LearnMoreLink"),s=its.loc("Purchases.AccountsMismatched.LearnMoreLinkLabel"),iTunes.appleAccountStore&&iTunes.appleAccountStore.primaryAppleAccount&&(n.iCloudAccount=iTunes.appleAccountStore.primaryAppleAccount.username)):e=="Purchases.SPAvailable.Message"&&(i=its.loc("Purchases.SPAvailable.LearnMoreLink"),s=its.loc("Purchases.SPAvailable.LearnMoreLinkLabel")),i&&(n.learnMoreLink=this.createMessageLinkElement(s,"iTunes.openURL('"+i+"')")),its.loc(e,n)},createMessageLinkElement:function(e,t){return'<a class="message-link" onclick="'+t+'">'+e+"</a>"},isSpBannerMessageDismissed:function(e){var t=!1,n=this._localStorageKeyForBannerMessageKey(e),r=iTunes.deviceLocalStorage;
return r?t=r.valueForKey(n):t=localStorage.getItem(n),t},dismissSpBannerMessage:function(e){var t=this._localStorageKeyForBannerMessageKey(e),n=iTunes.deviceLocalStorage;
n?n.setValue(t,"true"):localStorage.setItem(t,"true")},_localStorageKeyForBannerMessageKey:function(e){var t;
return iTunes.appleAccountStore&&iTunes.appleAccountStore.primaryAppleAccount&&(t=iTunes.appleAccountStore.primaryAppleAccount.dsID),t||(t="none"),"sf.purchases.dismissed."+t+"."+e},getSpMembersToDisplay:function(e,t){if(!e||e.length==0)return e;
var n=its.sf.Client.dsId(),r=its.sf.Client.iCloudDsid(),i=[],s=null;
for(var o=0;
o<e.length;
++o){var u=e[o];
u.isMe?s=u:i.push(u)}return t||(s||(s={displayName:its.loc("Purchases.MyPurchases"),iCloudDsid:r?r:"-1",iTunesPreferredDsid:n,isMe:!0}),i.unshift(s)),i},getSpmemberData:function(e,t){for(var n=0;
n<e.length;
++n){var r=e[n];
if(r.iCloudDsid==t)return r}},selectedLabel:function(e){return e.isMe?its.loc("Purchases.MyPurchases"):its.loc("Purchases.MemberPurchases",{displayName:e.displayName})},isPurchaseSharable:function(e,t){var n=!0;
if(e==null)n=!1;
else if(t!=null){var r=new Date(e),i=new Date(t);
n=i>r}return n}},its.kit.createController("iTSUpdateAllButton",{binding:".update-all",component:{init:function(){this.listen("click"),this.dilSelectMenu=document.querySelector("#dil-menu");
var e=bind(this,"execute");
iTunes.updateAllOnUpdatesPageLoad?its.kit.onLoad(e):(its.notifications.subscribe("softwareUpdates:updateAll",e),its.notifications.subscribe("softwareUpdates.setUpdateAllButtonDisabled",bind(this,"setUpdateAllButtonDisabled")),its.notifications.subscribe("softwareUpdates.setUpdateAllButtonEnabled",bind(this,"setUpdateAllButtonEnabled")))},clickEvent:function(e){if(e.currentTarget!=this.element)return;this.execute()},execute:function(){var e=[],t=its.client.getUserDSID(),n=document.querySelectorAll("#updates div.multi-button:not(.people-actions-button) button"),r=[];
n.each(function(n){if(n.disabled||this.isInstalledOrInstalling(n))return;var i=n.getAttribute("bundle-id"),s=n.getAttribute("adam-id"),o=iTunes.softwareApplicationWithBundleIdentifier(i),u=its.string.compareNumerically(iTunes.systemVersion(),"10.9")<0,a=its.client.appIsEligibleForAdoption(i)&&!its.client.adoptionCompleted(i);
if(o&&o.dsID)var f=o.dsID;
var l=!1;
u&&f?(t||(t=f),l=t==f):l=!0,a&&r.push({itemId:s,bundleId:i}),l&&(n.disabled=!0,its.client.startProgressSpinner()),e.push(this.attributesForButton(n))},this),this.element.disabled=!0,this.dilSelectMenu&&(this.dilSelectMenu.disabled=!0),r.length?its.client.adopt(r,bind(this,function(){this.performUpdateAll(e)})):this.performUpdateAll(e)},performUpdateAll:function(e){"updateAll"in iTunes?(iTunes.availableOSUpdates&&iTunes.availableOSUpdates.forEach(function(t){t.isRecommended!==!1&&!(t.key in ITSOSUpdates.activeUpdates)&&e.push(t)}),e.length&&iTunes.updateAll(e,bind(this,"handleUpdateAllActionFinished"))):e.length&&iTunes.buy(e,bind(this,this.handleBuyActionFinished))},attributesForButton:function(e){function t(t){return e.getAttribute(t)}return{itemId:t("adam-id"),itemType:"software",actionParams:t("buy-params"),title:t("item-name"),freeDownload:t("is-free-download"),bundleId:t("bundle-id"),update:t("is-update"),preflight:t("preflight")}},isInstalledOrInstalling:function(e){var t=e.getAttribute("adam-id"),n=iTunes.activeDownloads.downloads,r=!1;
return n.each(function(e){if(e.adamID==t)return r=!0,EachLoopBreak}),r},setUpdateAllButtonDisabled:function(){this.element.disabled=!0,this.dilSelectMenu&&(this.dilSelectMenu.disabled=!0)},setUpdateAllButtonEnabled:function(){this.element.disabled=!1,this.dilSelectMenu&&(this.dilSelectMenu.disabled=!1)},handleUpdateAllActionFinished:function(e){e.success||(its.client.stopProgressSpinner(),this.element.disabled=!1,this.dilSelectMenu&&(this.dilSelectMenu.disabled=!1)),e.adamID?this.handleBuyActionFinished(e):its.notifications.publish("OSUpdateCallback",e)},handleBuyActionFinished:function(e){its.client.stopProgressSpinner();
if(e&&e.success)this.dispatchCustomEvent(this.element,iTSBuyButton.Events.BUY_SUCCEEDED);
else{var t=document.querySelector('div.multi-button button[adam-id="'+e.adamID+'"]');
this.isInstalledOrInstalling(t)||(t.disabled=!1),console.log("Error in update all: errorCode "+e.errorCode);
if(e.errorCode!=-128){console.log("Error in update all: errorDomain "+e.errorDomain);
if(e.errorDomain&&e.errorDomain=="PreflightErrorDomain"){var n=its.loc("Js.PreflightCheckFailedError.UpdateTitle"),r=its.loc("Js.PreflightCheckFailedError.Message");
if(e.localizedErrorDescription||e.localizedErrorRecoverySuggestion)r=e.localizedErrorDescription?e.localizedErrorDescription:"",e.localizedErrorRecoverySuggestion&&(r+=" "+e.localizedErrorRecoverySuggestion);
its.client.showAlert(n,r)}else its.client.showGenericErrorAlertWithErrorCode(e.errorCode)}}}}}),its.kit.createController("iTSAdoptButton",{binding:".adopt-button, .claim-button",component:{init:function(){this.listen("click"),this.handledClaimActionFinished=!1},clickEvent:function(e){if(e.currentTarget!=this.element)return;this.element.disabled=!0;
if(this.element.hasClassName("adopt-button")){var t=[],n=document.querySelectorAll("tr.adopt");
n.each(function(e){t.push(this.attributesForRow(e))},this),t.length&&(its.client.startProgressSpinner(),its.client.adopt(t,bind(this,this.handleAdoptActionFinished)))}else iTunes.eligibleUpToDateApps()&&!iTunes.eligibleUpToDateApps().empty()&&this.element.hasClassName("claim-button")&&(its.client.startProgressSpinner(),its.client.claimAllEligibleApps(bind(this,this.handleClaimActionFinished)),iTunes.addEventListener("downloadstatuschanged",bind(this,this.handleDownloadStatusChanged),!1))},handleDownloadStatusChanged:function(e){this.handledClaimActionFinished||iTunes.eligibleUpToDateApps()&&iTunes.eligibleUpToDateApps().empty()&&(iTunes.removeEventListener("downloadstatuschanged",bind(this,this.handleDownloadStatusChanged),!1),this.handledClaimActionFinished=!0,its.client.stopProgressSpinner(),window.location.reload())},attributesForRow:function(e){function t(t){return e.getAttribute(t)}return{itemId:t("data-adam-id"),bundleId:t("data-bundle-identifier")}},handleAdoptActionFinished:function(e){its.client.stopProgressSpinner();
if(e&&e.success)window.location.reload();
else{this.element.disabled=!1,e&&e.errorCode&&e.errorCode&&console.log("Error in adopt: errorCode "+e.errorCode);
if(e&&e.errorReason){var t=e.errorReason;
console.log("Error in adopt: errorReason "+t);
if(t=="MZFinance.SoftwareAlreadyAdoptableByOtherAccount"||t=="MZFinance.SoftwareAlreadyAdoptableByThisAccount"||t=="MZFinance.SoftwareNotAdoptableForSerial"){var n=its.url.baseUrl(window.location.href);
n==window.location.href?window.location.reload():window.location.href=n}}}},handleClaimActionFinished:function(e){its.client.stopProgressSpinner();
if(e&&e.success)window.location.reload();
else{this.element.disabled=!1,e&&e.errorCode&&e.errorCode&&console.log("Error in claim: errorCode "+e.errorCode);
if(e&&e.errorReason){var t=e.errorReason;
console.log("Error in claim: errorReason "+t)}}}}}),its.kit.createController("iTSInstallation",{controller:{logger:new ITSLogger.named("developerLogger"),currentState:null,currentPercentage:null,previousState:null,previousPercentage:null,domReady:function(){this.setupContextMenus(),this.populateOtherPurchases(),this.bindToElements("#utd-os-updates .installation:not(.adopt)"),this.bindToElements("#critical-os-updates .installation:not(.adopt)"),this.bindToElements("#os-and-app-updates .installation:not(.adopt)"),this.bindToElements("#purchases .installation:not(.adopt)"),this.updateExistingInstallations();
var e=its.client.isRunning?iTunes:window;
this.listen(e,"downloadstatuschanged"),this.listen(window,"blur","pageEvent"),this.listen(window,"focus","pageEvent"),this.listen(document,"keydown","keyEvent"),this.listen(document,"keyup","keyEvent"),this.hasCheckedForClaimIsland=!1,this.hideDSIDlessAdamIds()},reInit:function(){for(var e=0;
e<this._components.length;
e++)this._unbindFromElement(this._components[e]);
this.domReady();
if(this.cachedState)try{for(var e=0;
e<this._components.length;
e++){var t=this._components[e].bundleIdentifier;
t&&this.cachedState[t]&&(this._components[e].setStatus(this.cachedState[t]),this._components[e].swapButtonVisibilities())}}catch(n){console.log(n)}},hideDSIDlessAdamIds:function(){if(localStorage.getItem("hda-configOverride")==1)var e={minimumSystemVersion:localStorage.getItem("hda-minimumSystemVersion"),whitelist:function(){return localStorage.getItem("hda-whitelist").split(",")}(),dataBundleRoot:localStorage.getItem("hda-dataBundleRoot")};
var t={minimumSystemVersion:"10.12",whitelist:["ElCapitan2","ElCapitan","Yosemite","Mavericks","MountainLion","Lion"],dataBundleRoot:"com.apple.InstallAssistant."},n=e||t,r=iTunes.systemVersion().split("."),i=r[0],s=r[1];
if(i>=11||i>=n.minimumSystemVersion.split(".")[0]&&s>=n.minimumSystemVersion.split(".")[1])var o=!0;
if(!o)return;var u=document.querySelectorAll(".lockup-container.installations.purchases:not(#other-purchases) tr");
if(u.length)for(var a=0;
a<u.length;
a++){var f=u[a].getAttribute("data-bundle-identifier");
if(f&&f.indexOf(n.dataBundleRoot)!==-1){var l=!1;
for(var c=0;
c<n.whitelist.length;
c++)f===n.dataBundleRoot+n.whitelist[c]&&(l=!0);
l||(u[a].style.display="none")}}},setupContextMenus:function(){if(!iTunes.addContextMenu){this.usesMenusForHide=!1;
return}this.usesMenusForHide=!0,iTunes.addEventListener("hidepurchase",bindAsEventListener(this,"hidePurchase",!0)),iTunes.addEventListener("hidepurchasenoconfirm",bindAsEventListener(this,"hidePurchase",!1)),iTunes.addContextMenu("hidepurchase",[{title:its.loc("DAHAppPurchasesPage.HidePurchaseMenuItemWithConfirmation"),event:"hidepurchase",alternateTitle:its.loc("DAHAppPurchasesPage.HidePurchaseMenuItem"),alternateEvent:"hidepurchasenoconfirm"}])},hidePurchase:function(e,t){var n=e.iTSInstallation;
n&&n.hidePurchase(t)},pageEvent:function(e){this.setCancelEnabled(!1)},keyEvent:function(e){e.which==18&&this.setCancelEnabled(e.altKey)},downloadstatuschangedEvent:function(e){var t=e.application;
if(its.client.isClientGreaterThanOrEqualToSpecifiedVersion("2")){var n={adamID:t.adamID,name:t.name,size:t.size,clientId:this.getClientId(),bundleVersion:t.bundleVersion,versionID:t.versionID,downloadStatus:{state:t.downloadStatus.state,percentComplete:t.downloadStatus.percentComplete,phasePercentComplete:t.downloadStatus.phasePercentComplete,timeRemaining:t.downloadStatus.timeRemaining}},r=t.bundleID==="com.apple.dt.Xcode",i=!1;
if(r){this.currentState=n.downloadStatus.state,this.currentPercentage=Math.floor(n.downloadStatus.percentComplete*100);
if(this.currentState!==this.previousState||this.currentPercentage!==this.previousPercentage)i=!0,this.previousState=this.currentState,this.previousPercentage=this.currentPercentage}this.logger.debug(this.getClientId(),n,i)}var s,o=this._components;
for(var u=0,a=o.length;
u<a;
u++)o[u].bundleIdentifier==t.bundleID&&(s=o[u]);
if(!s)return;setTimeout(function(){s.downloadstatuschangedEvent(e)},0),t.downloadStatus.state==iTSInstallation.CANCELED&&this.didCancelDownload(s)},getClientId:function(){var e=this.clientId;
if(!e){var t=iTunes.cookies;
t=t.substr(t.indexOf("xp_ci"),t.length),t=t.substr(t.indexOf("=")+1,t.length),t=t.substr(0,t.indexOf(";")),this.clientId=t,iTunes.log("developerLogger clientID: "+this.clientId)}return this.clientId},setCancelEnabled:function(e){this.applyToComponents(function(){this.setCancelEnabled(e)})},activeDownloads:function(){var e;
return its.client.isRunning&&(e=iTunes.activeDownloads.downloads),!e||!e.length?[]:e},updateExistingInstallations:function(){var e=this.activeDownloads();
e.forEach(function(e){this.downloadstatuschangedEvent({application:e})},this)},populateOtherPurchases:function(){function o(e){try{var t=JSON.parse(e.responseText);
r.children.each(function(e,n){var r=e.querySelector(".purchase-date");
r.innerHTML=t[n]})}catch(n){u()}}function u(){var t=e.querySelector(".purchase-date-header");
t&&(t.style.display="none")}var e=document.getElementById("other-purchases");
if(!e)return;this.otherPurchasesTemplate=this.otherPurchasesTemplate||e.querySelector(".installation");
var t=this.activeDownloads(),n=this.otherPurchasesTemplate,r=e.querySelector("tbody"),i=e.getAttribute("data-date-format-url"),s=[];
showDates=!0,r.innerHTML="",t.forEach(function(e){var t=e.bundleID;
if(document.querySelector('.installation[data-bundle-identifier="'+t+'"]'))return;var i=e.purchaseDate;
i===0&&(showDates=!1),s.push(i);
var o=n.cloneNode(!0),u=o.querySelector("img.artwork"),a=o.querySelector("h2"),f=o.querySelector(".publisher"),l=o.querySelector(".purchase-date");
o.setAttribute("data-adam-id",e.adamID),o.setAttribute("data-bundle-identifier",t),e.downloadStatus.downloadKey&&o.setAttribute("data-download-key",e.downloadStatus.downloadKey),u&&(u.src=e.iconURL,u.onerror=function(){this.style.visibility="hidden"}),a&&(a.innerHTML=e.name),r.appendChild(o)}),r.children.length&&(showDates?iTSInclude.makeHttpRequest({url:its.url.appendUrlParameters(i,{time:s.join(",")}),successCallback:o,failureCallback:u,timeout:2500}):u(),e.removeClassName("hidden")),its.kit.rebind()},didCancelDownload:function(e){var t=document.getElementById("other-purchases");
if(!t)return;var n=t.querySelector("tbody");
e.element.parentNode==n&&n.removeChild(e.element),n.children.length||t.addClassName("hidden")}},component:{init:function(){var e=this.element;
if(this.element.hasClassName("incompatible"))return;this.appName=e.querySelector("h2").innerText,this.type=e.getAttribute("data-installation-type")||"install",this.buyButton=e.querySelector(".multi-button"),this.adamID=e.getAttribute("data-adam-id"),this.bundleIdentifier=e.getAttribute("data-bundle-identifier"),this.bundleIdentifier==null&&this.buyButton&&(this.bundleIdentifier=this.buyButton.querySelector(".button-area").getAttribute("bundle-id")),this.downloadKey=e.getAttribute("data-download-key");
if(this.buyButton){var t=this.buyButton.querySelector("button");
this.bundleVersion=t.getAttribute("version-string"),this.versionID=t.getAttribute("versionID"),this.showHideUrl=e.getAttribute("show-hide-url"),this.isRestoreButton=this.buyButton&&this.buyButton.hasClassName("restore"),this.isDownloadButton=its.string.startsWith(this.bundleIdentifier,"com.apple.InstallAssistant.")}this.button=e.querySelector("button.install-button")||document.createElement("span"),this.button&&this.listen(this.button,"click","buttonClickEvent"),this.restoreButton=e.querySelector("div.restore"),this.restoreButton&&this.listen(this.restoreButton,"click","restoreButtonClick"),this.hideButton=e.querySelector("button.hide"),this.hideButton&&(this.listen(this.hideButton,"click","hideButtonClickEvent"),this.controller.usesMenusForHide&&(this.element.setAttribute("context-menu","hidepurchase"),this.hideButton.addClassName("hidden"))),this.status=e.querySelector(".status")||document.createElement("span"),this.description=e.querySelector(".description")||document.createElement("span"),!this.isRestoreButton&&this.bundleIdentifier&&this.versionID&&this.installedOrUpdateCheck(),this.setCancelEnabled(!1)},hidePurchase:function(e){var t=its.loc;
if(e&&its.client.isClientGreaterThanOrEqualToSpecifiedVersion("1.0.1")){var n=t("DAHAppPurchasesPage.HidePurchaseConfirmation.Title",{appName:this.appName}),r=t("DAHAppPurchasesPage.HidePurchaseConfirmation.Message"),i=bind(this,"hideButtonClickEvent"),s=t("Cancel"),o=t("DAHAppPurchasesPage.HidePurchaseConfirmation.Confirm");
its.client.showConfirm(n,r,i,null,o,s)}else this.hideButtonClickEvent()},hideButtonClickEvent:function(){this.listen("webkitAnimationEnd","removedPurchaseFadeOut"),this.element.addClassName("removing"),this.performShowHide(!0)},removedPurchaseFadeOut:function(e){this.element.remove();
var t=document.querySelector(".purchases:not(#other-purchases)");
t.querySelectorAll(".installation").length||window.location.reload()},restoreButtonClick:function(e){this.element.addClassName("restored"),this.buyButton.querySelector(".price").innerHTML=its.loc("DVHMusicPurchasesPage.Restored"),this.performShowHide(!1)},performShowHide:function(e){var t={isHidden:e},n=its.url.appendUrlParameters(this.showHideUrl,t);
iTSInclude.makeHttpRequest({url:n,successCallback:bind(this,"performShowHideSuccess",e),failureCallback:bind(this,"performShowHideFailure",e)})},performShowHideSuccess:function(e,t){},performShowHideFailure:function(e,t){this.element.removeClassName("removed"),this.element.removeClassName("removing"),this.element.removeClassName("restored"),e||(this.buyButton.querySelector(".price").innerHTML=its.loc("DVHMusicPurchasesPage.Restore"))},installedOrUpdateCheck:function(){if(!its.client.isRunning)return;iTSInstallation.logger.info("Performing installed or update check");
var e=iTunes.softwareApplicationWithBundleIdentifier(this.bundleIdentifier),t=!1;
if(!e)return;var n=e.versionID,r=e.bundleVersion,i=its.client.isClientGreaterThanOrEqualToSpecifiedVersion("1.0.1");
if(!e.adamID&&i){iTSInstallation.logger.info("App on disk not purchased from App StoreÂ â ignoringâ¦");
return}if(n&&this.versionID){t=its.string.toInt(n)<its.string.toInt(this.versionID);
if(t&&iTunes.availableAppUpdates){var s=!1;
for(var o=0,u=iTunes.availableAppUpdates.length;
o<u;
o++)if(iTunes.availableAppUpdates[o]["item-id"]==e.adamID){s=!0;
break}t=s}this.isDownloadButton&&t==0}iTSInstallation.logger.info("isUpdate: "+t);
var a=this.buyButton.querySelector("button"),f,l;
if(t){f="MHJavascriptLocalizations.DIBuyButtonUpdate",l="DIBuyButtonUpdateAria",this.isDownloadButton&&(f="MHJavascriptLocalizations.DIBuyButtonDownload",l="DIBuyButtonRedownloadAria"),this.buyButton.querySelector(".price").innerHTML=its.loc(f),this.buyButton.addClassName("update-button");
if(a){var c=a.querySelector("span.price");
a.setAttribute("aria-label",c.innerText+" "+e.name),a.setAttribute("redownload-buy-params",a.getAttribute("buy-params")),a.setAttribute("buy-params",a.getAttribute("update-buy-params")),a.setAttribute("is-update",1)}}else its.string.compareNumerically(navigator.appVersion,"2.0")>=0?(this.isDownloadButton?(f="Js.DA.BuyButton.Install",l="DABuyButton.aria.install"):(f="DAHSoftwareInstall.Button.Open",l="DAHSoftwareInstall.Button.Open"),a&&a.setAttribute("aria-label",its.loc(l,{name:e.name})),a.shouldOpen=!0):(f="DAHSoftwareInstall.Button.Installed",l="DAHSoftwareInstall.Button.Installed",this.buyButton.addClassName("disabled"),a&&(a.setAttribute("aria-label",its.loc(l,{name:e.name})),a.setAttribute("aria-disabled","true"))),this.buyButton.querySelector(".price").innerHTML=its.loc(f)},downloadstatuschangedEvent:function(e){if(!this.hasCheckedForClaimIsland&&iTunes.eligibleUpToDateApps&&iTunes.eligibleUpToDateApps().empty()){var t=document.querySelector(".installations.claim");
t&&t!=="undefined"&&t.addClassName("hidden"),this.hasCheckedForClaimIsland=!0}this.fileSize=e.application.size,this.downloadKey=e.application.downloadStatus.downloadKey,this.controller.cachedState=this.controller.cachedState||{},this.controller.cachedState[e.application.bundleID]=e.application.downloadStatus,this.setStatus(e.application.downloadStatus),this.swapButtonVisibilities()},buttonClickEvent:function(e){this.cancelEnabled?(this.controller.setCancelEnabled(!1),this.cancel()):this.state==iTSInstallation.DOWNLOADING||this.state==iTSInstallation.WAITING?this.pause():this.state==iTSInstallation.PAUSED?this.resume():this.install()},setCancelEnabled:function(e){var t=its.loc,n="DAHSoftwareInstall.Button.",r;
switch(this.state){case iTSInstallation.WAITING:e?(this.button.removeClassName("inactive"),this.button.removeAttribute("aria-disabled")):(this.button.addClassName("inactive"),this.button.setAttribute("aria-disabled","true"));
case iTSInstallation.DOWNLOADING:r="Pause";
break;case iTSInstallation.PAUSED:r="Resume";
break;default:return}this.adamID==0?this.cancelEnabled=!0:this.cancelEnabled=e,this.button.innerHTML=this.cancelEnabled?t(n+"Cancel"):t(n+r)},pause:function(){iTunes.pauseDownload(this.downloadKey?this.downloadKey:this.adamID)},resume:function(){iTunes.resumeDownload(this.downloadKey?this.downloadKey:this.adamID)},cancel:function(){iTunes.cancelDownload(this.downloadKey?this.downloadKey:this.adamID)},install:function(){},swapButtonVisibilities:function(){var e=this.element.querySelector(".multi-button.install-button"),t=this.element.querySelector("span.update"),n=this.element.querySelector("span.update button");
this.error?(e&&e.removeClassName("hidden"),t&&(t.removeClassName("hidden"),n.addClassName("hidden"))):this.canceled?(e&&e.removeClassName("hidden"),t&&t.addClassName("hidden")):(e&&e.addClassName("hidden"),t&&t.removeClassName("hidden"))},setStatus:function(e){var t=this.button,n=this.status,r=this.description,i="DAHSoftwareInstall.Button.",s="DAHSoftwareInstall.Status.",o=its.loc,u=this.state;
this.state=e.state,this.canceled=!1,this.error=!1,n.removeClassName("error"),t.removeClassName("inactive"),t.removeAttribute("aria-disabled"),t.removeClassName("hidden");
switch(this.state){case iTSInstallation.WAITING:case iTSInstallation.WAITING_TO_INSTALL:n.removeAttribute("aria-hidden"),this.cancelEnabled?(t.removeClassName("inactive"),t.removeAttribute("aria-disabled")):(t.addClassName("inactive"),t.setAttribute("aria-disabled","true")),t.innerHTML=this.cancelEnabled?o(i+"Cancel"):o(i+"Pause"),n.innerHTML=o(s+(this.state==iTSInstallation.WAITING?"Waiting":"WaitingToInstall")),its.kit.sendToController("iTSPurchaseAndUpdatePageController","addActiveUpdate",this.bundleIdentifier),its.kit.sendToController("iTSPurchaseAndUpdatePageController","addInstallation",this.bundleIdentifier);
break;case iTSInstallation.DOWNLOADING:n.removeAttribute("aria-hidden"),t.innerHTML=this.cancelEnabled?o(i+"Cancel"):o(i+"Pause"),n.innerHTML=iTSInstallation.progressBar(e.percentComplete*100)+"<br>"+iTSInstallation.downloadProgress(this.fileSize,e.phasePercentComplete)+" â "+iTSInstallation.timeRemaining(e.timeRemaining),its.kit.sendToController("iTSPurchaseAndUpdatePageController","addActiveUpdate",this.bundleIdentifier),its.kit.sendToController("iTSPurchaseAndUpdatePageController","addInstallation",this.bundleIdentifier);
break;case iTSInstallation.INSTALLING:n.removeAttribute("aria-hidden"),t.addClassName("inactive"),t.setAttribute("aria-disabled","true"),t.innerHTML=o(s+"Installing"),n.innerHTML=iTSInstallation.progressBar(e.percentComplete*100)+"<br>"+o(s+"Installing")+" â "+iTSInstallation.timeRemaining(e.timeRemaining),its.kit.sendToController("iTSPurchaseAndUpdatePageController","addActiveUpdate",this.bundleIdentifier),its.kit.sendToController("iTSPurchaseAndUpdatePageController","addInstallation",this.bundleIdentifier);
break;case iTSInstallation.INSTALLED:n.setAttribute("aria-hidden","true"),t.innerHTML=o(this.isDownloadButton?"MHJavascriptLocalizations.DIBuyButtonDownloaded":i+"Installed"),t.addClassName("inactive"),t.setAttribute("aria-disabled","true"),defer(this,function(){n.innerHTML=""}),its.kit.sendToController("iTSPurchaseAndUpdatePageController","addActiveUpdate",this.bundleIdentifier),its.kit.sendToController("iTSPurchaseAndUpdatePageController","removeInstallation",this.bundleIdentifier);
break;case iTSInstallation.PAUSED:t.innerHTML=this.cancelEnabled?o(i+"Cancel"):o(i+"Resume"),u==iTSInstallation.WAITING?n.innerHTML=o(s+"Paused"):n.innerHTML=o(s+"Paused")+"<br>"+iTSInstallation.downloadProgress(this.fileSize,e.phasePercentComplete),its.kit.sendToController("iTSPurchaseAndUpdatePageController","addActiveUpdate",this.bundleIdentifier),its.kit.sendToController("iTSPurchaseAndUpdatePageController","removeInstallation",this.bundleIdentifier);
break;case iTSInstallation.CANCELED:this.canceled=!0,t.innerHTML="",n.innerHTML="",its.kit.sendToController("iTSPurchaseAndUpdatePageController","removeActiveUpdate",this.bundleIdentifier),its.kit.sendToController("iTSPurchaseAndUpdatePageController","removeInstallation",this.bundleIdentifier);
break;case-1:default:this.error=!0,n.addClassName("error"),n.innerHTML=o(s+"Error"),its.kit.sendToController("iTSPurchaseAndUpdatePageController","removeActiveUpdate",this.bundleIdentifier),its.kit.sendToController("iTSPurchaseAndUpdatePageController","removeInstallation",this.bundleIdentifier)}its.notifications.publish("softwareUpdates.updateStatusChange")}}}),its.kit.util.extend(iTSInstallation,{WAITING:1,DOWNLOADING:2,INSTALLING:3,INSTALLED:4,PAUSED:5,CANCELED:6,WAITING_TO_INSTALL:7,ERROR:-1,logger:new ITSLogger("iTSInstallation"),humanReadableBytes:function(e){var t,n;
e<1e3?(t="FileSize.bytes",n=1):e<999500?(t="FileSize.KB",n=1e3):e<9995e5?(t="FileSize.MB",n=1e6):(t="FileSize.GB",n=1e9);
var r=e/n,i=0;
r<9.995&&n>=1e9?i=2:r<99.95&&n>=1e6&&(i=1);
var s=its.loc(t,{size:r.toFixed(i)});
return s=s.replace(/\./g,its.loc("DAHSoftwareInstall.Status.FileSizeSeparator")),s},timeRemaining:function(e){function t(e,t){return its.loc("DAHSoftwareInstall.Status.EstimatedTime."+e,t)}var n,r,i,s;
return e>=86400?(r=Math.floor(e/86400),i=Math.floor(e%86400/3600),n=t("DaysLeft",{days:r,hours:i?i:"",dayUnit:r==1?t("day"):t("days"),hourUnit:i==1?t("hour"):i?t("hours"):""})):e>=3600?(i=Math.floor(e/3600),s=Math.floor(e%3600/60),n=t("HoursLeft",{hours:i,minutes:s?s:"",hourUnit:i==1?t("hour"):t("hours"),minuteUnit:s==1?t("minute"):s?t("minutes"):""})):e>=60?(s=Math.floor(e/60),n=t("MinutesLeft",{minutes:s,minuteUnit:s==1?t("minute"):t("minutes")})):e>=0?n=t("LessThanAMinute"):n=t("Calculating"),n},downloadProgress:function(e,t){var n=Math.floor(e*t),r=its.loc("DAHSoftwareInstall.Status.Downloading",{completed:iTSInstallation.humanReadableBytes(n),total:iTSInstallation.humanReadableBytes(e)});
return r},progressBar:function(e){return roundedPercent=Math.floor(e),'<div class="progress" value="'+roundedPercent+'" max="100" aria-label="'+roundedPercent+'%">'+'<span style="width: '+e+'%">'+roundedPercent+"%</span>"+"</div>"}}),its.kit.createController("iTSInstallationDoneButton",{binding:".done-button",component:{init:function(){this.listen("click")},clickEvent:function(){var e=window.location.href,t=its.url.baseUrl(e),n=its.url.queryParamsDict(e);
n.mode="UNHIDDEN",its.client.goBackOrGoHome()}}}),its.kit.createController("iTSPurchaseAndUpdatePage",{controller:{logger:new ITSLogger("iTSPurchaseAndUpdatePage"),availableAppUpdates:iTunes.availableAppUpdates||[],incompatibleAppUpdates:iTunes.incompatibleAppUpdates||[],numOSUpdatesAvailable:function(){return iTunes&&iTunes.availableOSUpdates?iTunes.availableOSUpdates.filter(function(e,t){return e.isCritical!==!0}).length:0},numCriticalUpdatesAvailable:function(){return iTunes&&iTunes.availableOSUpdates?iTunes.availableOSUpdates.filter(function(e,t){return e.isCritical==1}).length:0},hasOnlyNonRecommendedUpdates:function(){return iTunes&&iTunes.availableOSUpdates?!this.hasAppUpdates()&&iTunes.availableOSUpdates.filter(function(e,t){return e.isRecommended==false}).length==this.numOSUpdatesAvailable():!1},numAppUpdatesAvailable:function(){return iTunes.availableAppUpdates?iTunes.availableAppUpdates.length:this.availableAppUpdates.length},numIncompatibleUpdates:function(){return iTunes.incompatibleAppUpdates?iTunes.incompatibleAppUpdates.length:this.incompatibleAppUpdates.length},totalNumUpdatesAvailable:function(){return this.numCriticalUpdatesAvailable()+this.numOSUpdatesAvailable()+this.numAppUpdatesAvailable()},hasOSUpdates:function(){return this.numOSUpdatesAvailable()>0},hasAppUpdates:function(){return this.numAppUpdatesAvailable()>0},hasIncompatibleUpdates:function(){return this.numIncompatibleUpdates()>0},hasInstalledUpdateHistory:function(){return iTunes.installedUpdateHistory&&iTunes.installedUpdateHistory.length>0},activeUpdates:{},currentInstallations:{},isInstalling:!1,domReady:function(){this.toolbarSelection=document.body.getAttribute("toolbar-selection"),this.toolbarSelection=="updates"?this.setupUpdatesPage():this.toolbarSelection=="purchased"&&this.setupPurchasesPage(),this.checkAppEligibilityStatus(),setTimeout(bind(this,"checkAppEligibilityStatus"),2e3),this.debounceUpdatesChanged=this.debounce(this.handleAvailableUpdatesChanged,3e3,!1),iTunes.addEventListener("availableupdateschanged",bind(this,"debounceUpdatesChanged"),!1)},setupUpdatesPage:function(){this.updateCount=0,this.timer=null,this.timeSinceLastUpdateChangedEvent=(new Date).getTime(),this.listen(iTunes,"installstatuschanged",bind(this,"handleInstallStatusChange")),its.notifications.subscribe("softwareUpdates.updateScanEvent",bind(this,"updateScanEvent")),its.notifications.subscribe("softwareUpdates.refreshUpdatePage",bind(this,"refreshUpdatePage")),its.notifications.subscribe("softwareUpdates.updateStatusChange",bind(this,"updateStatusChange")),this.scanningLocKey=iTunes.availableAppUpdates?"DAHSoftwareUpdatesPage.OSUpdates.ScanningAuto":"DAHSoftwareUpdatesPage.OSUpdates.Scanning",its.string.compareNumerically(its.client.osVersion(),"10.13")>=0?this.osVersionClass="high-sierra":its.string.compareNumerically(its.client.osVersion(),"10.12")>=0?this.osVersionClass="sierra":its.string.compareNumerically(its.client.osVersion(),"10.11")>=0?this.osVersionClass="elcapitan el-capitan":its.string.compareNumerically(its.client.osVersion(),"10.10")>=0?this.osVersionClass="yosemite":its.string.compareNumerically(its.client.osVersion(),"10.9")>=0?this.osVersionClass="mavericks":this.osVersionClass="",this.buildUpdatesHeader(),this.buildNoResultsContainer(),this.buildOnlyIncompatibleUpdatesContainer(),this.buildCriticalOSUpdatesContainer(),this.buildOSAndAppUpdatesContainer(),this.displayAutoInstalledUpdates(),this.fetchedData=null,iTunes.availableAppUpdates?this.displayAppUpdates():this.fetchAppUpdatesData(),this.updateStrings=document.querySelectorAll(".update-count-string"),this.updateAllButton=document.querySelector(".multi-update-all")||document.querySelector(".update-all"),this.refreshUpdateAllButtonVisibility(),this.refreshUpdatePage()},updateScanEvent:function(e){this.totalNumUpdatesAvailable()==0?(this.showScanProgress(),e.scanCompleted&&setTimeout(bind(this,function(){this.hideScanProgress()}),2e3)):e.scanCompleted?(this.hideScanProgress(),clearTimeout(this.timer),this.timer=null):this.timer||(this.timer=setTimeout(bind(this,function(){this.showScanProgress()}),2e3))},fetchAppUpdatesData:function(){this.showScanProgress();
try{var e=its.serverData.constants.fetchSoftwareUpdatesUrl,t=its.serverData.pageData.softwareUpdatePostDictionaryString;
if(e&&t){var n=new XMLHttpRequest;
n.onreadystatechange=bind(this,function(e){n.readyState==4&&(n.status==200?(this.hideScanProgress(),this.fetchedData=JSON.parse(n.responseText),this.availableAppUpdates=this.convertStorePlatformData(this.fetchedData.updateLockups),this.incompatibleAppUpdates=this.convertStorePlatformData(this.fetchedData.incompatibleLockups),this.displayAppUpdates()):this.hideScanProgress())}),n.open("POST",e,!0),n.send(t)}}catch(r){console.error(r),this.hideScanProgress()}},convertStorePlatformData:function(e){if(e instanceof Array)return;var t=[];
for(var n in e)t.push(e[n]);
return t},bestArtworkForSize:function(e,t,n,r){if(!e||!t)return null;
var i=t.width,s=t.height;
if(!i){if(!s)return null;
i=s}else s||(s=i);
var o=!1,u={width:1e5,height:1e5},a={width:0,height:0},f=e.length;
for(var l=0;
l<f;
l++){var c=e[l],h=function(e,t){var n=e?e.length:0,r=t?t.length:0;
if(n!=r)return!1;
for(var i=0;
i<n;
i++)if(e.indexOf(t[i])==-1)return!1;
return!0};
if(!h(n,c.effects))continue;var p=c.width,d=c.height;
if(d>s||p>i){if(d<u.height||p<u.width)u=c,o=!0}else{var v=r?d===s&&p===i:d===s||p===i;
if(v)return c;
if(d>a.height||p>u.width)a=c}}return o?u:a},getStorePlatformArtworkData:function(e){var t=this.fetchedData.storePlatformData.lockup.results;
if(t)return this.bestArtworkForSize(t[e.id].artwork,{width:84,height:84},null,!0).url;
return},buildNoResultsContainer:function(){try{var e=its.Template.create("no-updates-template").replaceToken("locEmptyPage",its.loc("DAHSoftwareUpdatesPage.EmptyPage")).replaceToken("locScanning",its.loc(this.scanningLocKey)).composeAsElement();
document.querySelector("#content").appendChild(e)}catch(t){}},buildOnlyIncompatibleUpdatesContainer:function(){try{var e=its.Template.create("only-incompatible-updates-template").replaceToken("locNoNewUpdates",its.loc("DAHSoftwareUpdatesPage.NoNewUpdates")).replaceToken("locShowIncompatibleAppUpdates",its.loc("DAHSoftwareUpdatesPage.ShowIncompatibleAppUpdates")).replaceToken("locScanning",its.loc(this.scanningLocKey)).composeAsElement();
document.querySelector("#content").appendChild(e)}catch(t){}},buildUpdatesHeader:function(){try{var e=its.Template.create("updates-header-template").replaceToken("locScanning",its.loc(this.scanningLocKey)).composeAsElement();
document.querySelector("#updates").appendChild(e)}catch(t){}},buildCriticalOSUpdatesContainer:function(){try{var e=its.Template.create("critical-os-updates-group-template").composeAsElement();
document.querySelector("#updates").appendChild(e)}catch(t){}},buildOSAndAppUpdatesContainer:function(){try{var e=its.Template.create("os-and-app-updates-group-template");
e.replaceToken("locScanning",its.loc(this.scanningLocKey)),e.replaceToken("locUpdateAll",its.loc("DAHSoftwareUpdatesPage.UpdateAll")),e.replaceToken("installNow",its.loc("DAHSoftwareUpdatesPage.AutoUpdates.InstallNow")),e.replaceToken("installHour",its.loc("DAHSoftwareUpdatesPage.AutoUpdates.InstallInAnHour")),e.replaceToken("installTonight",its.loc("DAHSoftwareUpdatesPage.AutoUpdates.InstallTonight")),e.replaceToken("remindMe",its.loc("DAHSoftwareUpdatesPage.AutoUpdates.RemindMe"));
var t=e.composeAsElement();
document.querySelector("#updates").appendChild(t);
var n=document.querySelector("#dil-menu");
if(n&&iTunes.installAvailableUpdatesLater){n.selectedIndex=-1;
var r=this;
n.addEventListener("change",function(){this.selectedIndex==0?its.notifications.publish("softwareUpdates:updateAll"):r.installUpdatesLater(this.options[this.selectedIndex].value)})}}catch(i){}its.kit.rebind()},setupPurchasesPage:function(){if(!its.client.isRunning)return;var e=document.querySelector(".page-banner-message-key");
if(e){var t=document.querySelector(".page-banner-message");
if(its.sf.PurchasesUtil.isSpBannerMessageDismissed(e.textContent))t.style.display="none";
else{var n=document.querySelector(".page-banner-message .close-button");
n&&n.addEventListener("click",function(){its.sf.PurchasesUtil.dismissSpBannerMessage(e.textContent),t.style.display="none"}.bind(this))}}var r=document.querySelector(".adopt-button"),s=document.querySelector(".claim-button"),o=r&&r.disabled||s&&s.disabled;
iTunes.addEventListener("userchanged",function(){if(o)return;var e=window.location.href,t=document.querySelectorAll(".adoption .adopt");
if(t&&t.length>0){var n="";
for(i=0;
i<t.length;
++i)i>0&&(n+=","),n+=t[i].getAttribute("data-adam-id");
baseUrl=its.url.baseUrl(e),queryParams=its.url.queryParamsDict(e),queryParams.bundleIds=n,e=its.url.appendUrlParameters(baseUrl,queryParams),e==window.location.href?window.location.reload():window.location.href=e}else window.location.reload()}),this.signIn=document.querySelector(".sign-in"),this.signIn&&(iTunes.addEventListener("authenticatefinished",function(){if(o)return;window.location.reload()}),this.signIn.addEventListener("click",function(){iTunes.signIn()}),this.signIn.setAttribute("role","link")),this.purchasedBundleIds=[],this.purchasedAppRows=document.querySelectorAll("tr[data-installation-type], #other-purchases tr[data-bundle-identifier]");
for(var u=0;
u<this.purchasedAppRows.length;
u++){var a=this.purchasedAppRows[u],f=a.querySelector("ul.info li h2").innerText;
a.setAttribute("aria-label",f)}var l=this;
this.purchasedAppRows.map(function(e){l.purchasedBundleIds.push(e.getAttribute("data-bundle-identifier"))}),iTunes.addEventListener("downloadstatuschanged",bind(this,"handleDownloadStatusChanged"),!1)},handleDownloadStatusChanged:function(e){var t=e.application.bundleID;
this.purchasedBundleIds.indexOf(t)<=-1&&window.location.reload()},checkAppEligibilityStatus:function(){if(this.toolbarSelection=="purchased"){this.claimableApps=[];
var e=document.querySelector(".claim");
if(e&&iTunes.eligibleUpToDateApps&&iTunes.eligibleUpToDateApps().length>0){var t=iTunes.eligibleUpToDateApps(),n=document.querySelectorAll(".claim .adopt");
for(i=0,len=n.length;
i<len;
i++){var r=parseInt(n[i].getAttribute("data-adam-id"));
t.indexOf(r)!=-1?this.claimableApps.push(r):n[i].remove()}if(this.claimableApps.length>0){var s=e.querySelector("thead th[colspan]"),o=s.textContent.match(/\d/);
o&&(s.textContent=s.textContent.replace(o,this.claimableApps.length)),e.removeClassName("hidden")}}var u=document.querySelectorAll("#adoption-island .adopt"),a=[],f,l;
if(u.length){for(i=0,len=u.length;
i<len;
i++)l=u[i].getAttribute("data-bundle-identifier"),iTunes.appIsEligibleForAdoption(l)?(f=u[i].querySelector("h2 a").innerText,a.push(f)):u[i].remove();
if(a.length){var c=its.locWithCount("DAHAppPurchasesPage.NumAcceptWithCount",a.length);
document.getElementById("num-accept").innerHTML=c,document.querySelector("#adoption-island table").setAttribute("aria-label",c);
var h=this.acceptDetailsString(a);
document.getElementById("accept-details").innerHTML=h}else document.getElementById("adoption-island").remove()}}else if(this.toolbarSelection=="updates"){var p=document.querySelector("#utd-os-updates");
p&&!localStorage.getItem("didHideUTDIsland")&&p.removeClassName("hidden")}},acceptDetailsString:function(e){var t="DAHAppPurchasesPage.AppsToAccept.Details",n={},r=e.length;
if(r>1){t+=".Plural";
var s="",o="",u=its.loc("DAHAppPurchasesPage.AppsToAccept.Details.ListSeparator");
for(i=0;
i<r;
i++)i==r-1?o=e[i]:(i!=0&&(s+=u),s+=e[i]);
n={firstApps:s,lastApp:o}}else t+=".Singular";
return its.loc(t,n)},showScanProgress:function(){document.body.removeClassName("page-not-ready"),document.body.addClassName("scanning"),its.client.screenReaderRunning()&&setTimeout(function(){var e=document.querySelectorAll(".scan-progress");
for(var t=0;
t<e.length;
t++)if(e[t].offsetHeight){e[t].setAttribute("tabIndex","-1"),e[t].focus();
break}},0)},hideScanProgress:function(){document.body.removeClassName("page-not-ready"),document.body.removeClassName("scanning"),its.client.screenReaderRunning()&&setTimeout(function(){var e=document.querySelectorAll(".non-scan-progress");
for(var t=0;
t<e.length;
t++){var n=e[t].getBoundingClientRect&&e[t].getBoundingClientRect();
if(e[t].offsetHeight){e[t].setAttribute("tabIndex","-1"),e[t].focus();
break}}},0)},setUpdateCount:function(){this.updateCount=this.hasOSUpdates()?this.numAppUpdatesAvailable()+1:this.numAppUpdatesAvailable();
if(!this.updateStrings||!this.updateStrings.length)return;var e="DAHSoftwareUpdatesPage.";
this.updateCount===0&&this.hasIncompatibleUpdates()?(this.updateCount=this.numIncompatibleUpdates(),e+="NumIncompatibleUpdates"):e+="NumUpdates";
var t=its.locWithCount(e,this.updateCount);
this.updateStrings.each(function(e){e.innerHTML=t}),this.refreshUpdateAllButtonVisibility()},refreshUpdatePage:function(){this.setUpdateCount(),this.updateCount===0?this.hasIncompatibleUpdates()?(document.querySelector(".no-updates").addClassName("hidden"),document.querySelector(".only-incompatible-updates").removeClassName("hidden")):(this.hasInstalledUpdateHistory()?(document.querySelector("#header").removeClassName("hidden"),document.querySelector(".no-updates").addClassName("hidden")):document.querySelector(".no-updates").removeClassName("hidden"),document.querySelector("#os-and-app-updates").addClassName("hidden")):(document.querySelector("#header").addClassName("hidden"),document.querySelector(".no-updates").addClassName("hidden"),document.querySelector("#os-and-app-updates").removeClassName("hidden")),this.numCriticalUpdatesAvailable()>0&&(document.querySelector("#header").addClassName("hidden"),document.querySelector(".no-updates").addClassName("hidden")),this.refreshUpdateAllButtonVisibility()},updateStatusChange:function(){var e=Object.keys(this.currentInstallations).length>0;
e?this.isInstalling||(this.isInstalling=!0,this.updateStrings.each(function(e){e.innerHTML=its.loc("DAHSoftwareUpdatesPage.InstallingUpdates")}),its.notifications.publish("softwareUpdates.setUpdateAllButtonDisabled")):(this.isInstalling=!1,this.refreshUpdatePage(),its.notifications.publish("softwareUpdates.setUpdateAllButtonEnabled"))},refreshUpdateAllButtonVisibility:function(){if(!this.updateAllButton)return;this.updateCount>0&&!this.hasOnlyNonRecommendedUpdates()?(this.updateAllButton.removeClassName("hidden"),this.updateAllButton.removeClassName("disabled")):(this.updateAllButton.addClassName("hidden"),this.updateAllButton.addClassName("disabled")),iTunes.shouldOfferDoItLater&&iTunes.installAvailableUpdatesLater?this.updateAllButton.addClassName("dil"):this.updateAllButton.removeClassName("dil")},setupIncompatibleUpdateToggle:function(){function e(e){e.preventDefault();
var t=document.querySelector(".show-incompatible-row");
t&&t.parentNode.removeChild(t);
var n=document.querySelector(".only-incompatible-updates");
n&&(n.addClassName("hidden"),document.querySelector("#os-and-app-updates").removeClassName("hidden")),document.body.addClassName("show-incompatible")}this.toggles=document.querySelectorAll(".show-incompatible-link"),this.toggles.each(function(t){t.addEventListener("click",e,!1)})},displayAppUpdates:function(){if(this.toolbarSelection=="purchased")return;iTunes.availableAppUpdates&&(this.availableAppUpdates=iTunes.availableAppUpdates),its.notifications.publish("softwareUpdates.refreshUpdatePage");
var e=its.Template.create("app-updates-template"),t=iTunes.installAvailableUpdatesLater?"UpdateAllMultiButton":"UpdateAllButton";
e.keepBlock(t),e.replaceToken("locScanning",its.loc(this.scanningLocKey)),e.replaceToken("locUpdateAll",its.loc("DAHSoftwareUpdatesPage.UpdateAll")),e.replaceToken("installNow",its.loc("DAHSoftwareUpdatesPage.AutoUpdates.InstallNow")),e.replaceToken("installHour",its.loc("DAHSoftwareUpdatesPage.AutoUpdates.InstallInAnHour")),e.replaceToken("installTonight",its.loc("DAHSoftwareUpdatesPage.AutoUpdates.InstallTonight")),e.replaceToken("locShowIncompatibleAppUpdates",its.loc("DAHSoftwareUpdatesPage.ShowIncompatibleAppUpdates"));
if(this.hasAppUpdates()){var n=this.availableAppUpdates,r=e.getBlock("Updates");
for(var i=0,s=n.length;
i<s;
i++){var o=n[i]["release-notes"]||n[i].releaseNotes||"";
r.replaceObjectUnescaped("update",{adamID:n[i]["item-id"]||n[i].id,title:n[i].title||n[i].name,version:its.loc("K2HSoftwareUpdatesLockup.Version",{version:n[i].version}),imageURL:n[i]["artwork-urls"]?n[i]["artwork-urls"][1].url:this.getStorePlatformArtworkData(n[i]),URL:n[i].url,author:n[i]["artist-name"]||n[i].developer,releaseDate:n[i].releaseDate||its.loc("DAHSoftwareUpdatesPage.ReleasedDate",{date:this.convertInstallDateFromClient(n[i]["release-date"])}),releaseNotes:o.replace(/\n/g,"<br />"),buyButton:this.generateUpdateButton(n[i])}),r.next()}}if(this.hasIncompatibleUpdates()){var u=this.incompatibleAppUpdates,a=e.getBlock("IncompatibleUpdates");
for(var i=0,s=u.length;
i<s;
i++){var o=u[i]["release-notes"]||u[i].releaseNotes,f=u[i].incompatibleUpdateLink?u[i].incompatibleUpdateLink.label:"",l=u[i].incompatibleUpdateLink?u[i].incompatibleUpdateLink.url:"";
a.replaceObjectUnescaped("incompatible",{title:u[i].title||u[i].name,version:its.loc("K2HSoftwareUpdatesLockup.Version",{version:u[i].version}),imageURL:u[i]["artwork-urls"]?u[i]["artwork-urls"][1].url:this.getStorePlatformArtworkData(u[i]),URL:u[i].url,author:u[i]["artist-name"]||u[i].developer,releaseDate:u[i].releaseDate||its.loc("DAHSoftwareUpdatesPage.ReleasedDate",{date:this.convertInstallDateFromClient(u[i]["release-date"])}),releaseNotes:o.replace(/\n/g,"<br />"),incompatibleUpdateLabel:f,incompatibleUpdateUrl:l}),a.next()}}e.compose(null,"#app-updates"),its.kit.sendToController("iTSInstallation","reInit"),its.kit.rebind(),document.querySelector(".show-incompatible-row")[this.hasIncompatibleUpdates()?"removeClassName":"addClassName"]("hidden"),this.setupIncompatibleUpdateToggle()},generateUpdateButton:function(e){try{var t=document.createElement("div");
t.addClassName("multi-button install-button update-button"),e.rating.rank?t.setAttribute("rating-software",e.rating.rank+","+e.rating.system):t.setAttribute("rating-software",e.rating["rating-software"]);
var n=document.createElement("button");
n.addClassName("button-area"),n.setAttribute("item-name",e.title||e.name),e["store-offers"]?n.setAttribute("update-buy-params",e["store-offers"].SWUPD["action-params"]):n.setAttribute("update-buy-params",e.offer.buyParams),n.setAttribute("aria-label",e.title||e.name),n.setAttribute("bundle-id",e["bundle-id"]||e.bundleId),n.setAttribute("version-string",e.version),e["store-offers"]?n.setAttribute("buy-params",e["store-offers"].SWUPD["action-params"]):n.setAttribute("buy-params",e.offer.buyParams),n.setAttribute("is-install-button","1"),n.setAttribute("versionID",e["version-external-identifier"]||e.versionExternalIdentifier),n.setAttribute("is-free-download","1"),n.setAttribute("is-update","1"),n.setAttribute("adam-id",e["item-id"]||e.id),e.preflight&&n.setAttribute("preflight",e.preflight);
var r=its.loc("DAHSoftwareInstall.Button.Update");
return n.innerHTML='<span class="price">Update</span><span class="left-cap"></span><div class="inner"><span>'+r+'</span></div><span class="right-cap"></span>',t.appendChild(n),t.outerHTML}catch(i){}},displayAutoInstalledUpdates:function(){if(!this.hasInstalledUpdateHistory())return;this.updateHistory&&document.querySelector("#updates").removeChild(this.updateHistory);
var e=iTunes.installedUpdateHistory.reverse();
if(e&&e.length)try{var t=its.Template.create("auto-updates-group-template"),n=t.getBlock("Installations");
t.keepBlock("Header",!0),t.keepBlock("NoHeader",!1),t.replaceToken("title",its.loc("DAHSoftwareUpdatesPage.RecentlyInstalled")),e.forEach(bind(this,function(e){var t=e["release-notes"]?e["release-notes"].replace(/\n/g,"<br />"):"";
if(e.__isSoftwareUpdate)n.keepBlock("OSLockup"),n.replaceObjectUnescaped("installation",{osVersionClass:this.osVersionClass,title:e.title,version:its.loc("K2HSoftwareUpdatesLockup.Version",{version:e.version}),installDate:its.loc("DAHSoftwareUpdatesPage.InstalledDate",{date:this.convertInstallDateFromClient(e.installDate)}),releaseNotes:this.replaceURLsWithLinks(t)});
else{var r=e["artwork-urls"][1];
r?(n.keepBlock("AppLockup"),n.replaceObjectUnescaped("installation",{title:e.title,version:its.loc("K2HSoftwareUpdatesLockup.Version",{version:e.version}),imageURL:e["artwork-urls"][1].url,URL:e.url,author:e["artist-name"],installDate:its.loc("DAHSoftwareUpdatesPage.InstalledDate",{date:this.convertInstallDateFromClient(e.installDate)}),releaseNotes:this.replaceURLsWithLinks(t)})):(n.keepBlock("OSLockup"),n.replaceObjectUnescaped("installation",{osVersionClass:this.osVersionClass,title:e.title,URL:e.url,author:e["artist-name"],version:its.loc("K2HSoftwareUpdatesLockup.Version",{version:e.version}),installDate:its.loc("DAHSoftwareUpdatesPage.InstalledDate",{date:this.convertInstallDateFromClient(e.installDate)}),releaseNotes:this.replaceURLsWithLinks(t)}))}n.next()})),this.updateHistory=t.composeAsElement(),this.updateHistory.querySelectorAll(".update").each(function(e){var t=e.querySelector(".install-button");
t.addClassName("inactive hidden"),t.innerHTML=its.loc("DAHSoftwareInstall.Button.Installed"),e.removeClassName("hidden")}),document.querySelector("#updates").appendChild(this.updateHistory)}catch(r){}},replaceURLsWithLinks:function(e){var t=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/ig;
return e.replace(t,"<a href='$1' target='_blank'>$1</a>")},convertInstallDateFromClient:function(e){var t=new Date;
t.setTime(e*1e3);
var n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],r=n[t.getMonth()],i=r+" "+t.getDate()+", "+t.getFullYear();
return i},addActiveUpdate:function(e){this.activeUpdates[e]=!0},removeActiveUpdate:function(e){delete this.activeUpdates[e]},addInstallation:function(e){this.currentInstallations[e]=!0},removeInstallation:function(e){delete this.currentInstallations[e]},handleAvailableUpdatesChanged:function(e){its.notifications.publish("softwareUpdates.updatesAdded"),this.displayAppUpdates(),this.displayAutoInstalledUpdates(),this.isInstalling||(its.client.stopProgressSpinner(),this.refreshUpdatePage(),its.notifications.publish("softwareUpdates.setUpdateAllButtonEnabled"))},installUpdatesLater:function(e){iTunes.installAvailableUpdatesLater(e),setTimeout(bind(this,function(){this.updatesForLaterCount=this.updateCount;
var e="DAHSoftwareUpdatesPage.UpdatesScheduled";
if(!this.updateStrings||!this.updateStrings.length)return;e+="."+(this.updatesForLaterCount==1?"Singular":"Plural");
var t=its.loc(e,{count:this.updatesForLaterCount});
this.updateStrings.each(function(e){e.innerHTML=t})}),0)},handleInstallStatusChange:function(e){var t=e.application.installed,n=e.application.bundleID,r=document.querySelector('.installation[data-bundle-identifier="'+n+'"]'),i=!t&&n&&!this.activeUpdates[n],s=t&&n&&this.activeUpdates[n];
s&&r&&!r.hasClassName("incompatible")&&(iTunes.availableAppUpdates||this.availableAppUpdates.forEach(bind(this,function(e,t){adamID==e.id&&this.availableAppUpdates.splice(t,1)})),this.isInstalling||(this.setUpdateCount(),its.kit.rebind()));
if(i){r&&(r.parentNode.removeChild(r),iTunes.availableAppUpdates||this.availableAppUpdates.forEach(bind(this,function(e,t){adamID==e.id&&this.availableAppUpdates.splice(t,1)})),this.setUpdateCount());
if(!document.querySelector(".installation.incompatible")){var o=document.querySelector(".show-incompatible-row");
o&&o.parentNode.removeChild(o)}}},debounce:function(e,t,n){var r;
return function(){function u(){n||e.apply(s,o),r=null}var s=this,o=arguments;
r?clearTimeout(r):n&&e.apply(s,o),r=setTimeout(u,t||100)}}}}),ITSOSUpdates={activeUpdates:{},numUpdatesAvailable:function(){return iTunes.availableOSUpdates?iTunes.availableOSUpdates.length:0},areCriticalUpdatesAvailable:function(){return iTunes.availableOSUpdates.some(function(e){return e.isCritical===!0})},criticalUpdates:function(){return iTunes.availableOSUpdates.filter(function(e,t){return e.isCritical===!0})},noncriticalUpdates:function(){return iTunes.availableOSUpdates.filter(function(e,t){return e.isCritical!==!0})},countCriticalUpdatesSeparately:!1},function(){function a(e){its.notifications.publish("softwareUpdates.updateScanEvent",e);
if(!e.scanCompleted&&!e.errorCode)l(e.percentComplete/100);
else if(e.scanCompleted||e.errorCode){if(e.errorCode){var t=its.loc("DAHSoftwareInstall.Status.Error"),n=e.localizedErrorDescription||"Error Code: "+e.errorCode;
its.client.showAlert(t,n)}var r=iTunes.updateAllOnUpdatesPageLoad;
setTimeout(function(){c(),r&&its.notifications.publish("softwareUpdates:updateAll")},500)}}function f(e){function c(e){switch(e){case 0:f.innerHTML="";
break;case 1:case 7:f.innerHTML=its.loc("DAHSoftwareInstall.Status.Waiting"+(n.state==7?"ToInstall":"")),i&&!ITSOSUpdates.activeUpdates[i].critical&&ITSOSUpdates.noncriticalUpdates().length>1&&h(),its.kit.sendToController("iTSPurchaseAndUpdatePageController","addInstallation",i);
break;case 2:case 3:f.innerHTML=w(n),l&&(n.canCancel?(l.isCancelMode=!0,l.innerHTML=its.loc("DAHSoftwareInstall.Button.Cancel"),l.removeClassName("disabled"),l.removeClassName("inactive"),l.setAttribute("aria-disabled","false")):(l.innerHTML=its.loc("DAHSoftwareInstall.Status.Installing"),l.addClassName("inactive"),l.setAttribute("aria-disabled","true"))),i&&!ITSOSUpdates.activeUpdates[i].critical&&ITSOSUpdates.noncriticalUpdates().length>1&&h(),its.kit.sendToController("iTSPurchaseAndUpdatePageController","addInstallation",i);
break;case 4:f.innerHTML="",l&&(l.isCancelMode=!1,t&&t.action==1?l.innerHTML=its.loc("DAHSoftwareInstall.Button.Restart"):(l.innerHTML=its.loc("DAHSoftwareInstall.Button.Installed"),l.addClassName("inactive"),l.setAttribute("aria-disabled","true"))),ITSOSUpdates.criticalUpdates().length===0&&(g(!0),u&&ITSOSUpdates.countCriticalUpdatesSeparately&&its.notifications.publish("softwareUpdates.refreshUpdatePage")),ITSOSUpdates.noncriticalUpdates().length===0&&(g(!1),!u&&ITSOSUpdates.countCriticalUpdatesSeparately&&its.notifications.publish("softwareUpdates.refreshUpdatePage")),!ITSOSUpdates.countCriticalUpdatesSeparately&&ITSOSUpdates.numUpdatesAvailable()===0&&its.notifications.publish("softwareUpdates.refreshUpdatePage"),its.kit.sendToController("iTSPurchaseAndUpdatePageController","removeInstallation",i),i&&delete ITSOSUpdates.activeUpdates[i];
break;case 6:l&&(l.isCancelMode=!1,l.innerHTML=its.loc("DAHSoftwareInstall.Button.Update"),l.removeClassName("inactive")),i?delete ITSOSUpdates.activeUpdates[i]:ITSOSUpdates.activeUpdates={},its.kit.sendToController("iTSPurchaseAndUpdatePageController","removeInstallation",i);
case 5:f.innerHTML="",l&&(l.isCancelMode=!1,l.removeClassName("disabled"),l.removeAttribute("aria-disabled"));
if(!i){var r=document.querySelectorAll("#os-updates .installation[data-key] .install-button");
r.each(function(e){e.removeClassName("disabled"),e.removeAttribute("aria-disabled")})}its.kit.sendToController("iTSPurchaseAndUpdatePageController","removeInstallation",i);
break;case-1:if(i)delete ITSOSUpdates.activeUpdates[i];
else{ITSOSUpdates.activeUpdates={};
var r=document.querySelectorAll("#os-updates .installation[data-key] .install-button");
r.each(function(e){e.removeClassName("disabled"),e.removeAttribute("aria-disabled")})}f.innerHTML=n.statusString,l&&(l.isCancelMode=!1,l.removeClassName("disabled"),l.removeAttribute("aria-disabled")),its.kit.sendToController("iTSPurchaseAndUpdatePageController","removeInstallation",i)}}var t=e.update,n=e.status,i=t&&t.key,u=e.includesCriticalUpdates;
i?ITSOSUpdates.activeUpdates[i]={critical:t.isCritical,recommended:t.isRecommended}:!u&&n.state>=0&&n.state<5&&m();
var a;
t&&(t.isCritical?s:r)>1?(a='.installation[data-key="'+i+'"]',document.querySelectorAll('*[data-key="'+i+'"][context-menu]').each(function(e){e.removeAttribute("context-menu")})):(t?t.isCritical:u)?a="#critical-os-updates .all-os-updates":a="#os-updates .all-os-updates";
var f=document.querySelector(a+" .status"),l=document.querySelector(a+" .install-button");
l&&(l.addClassName("disabled"),l.setAttribute("aria-disabled","true")),n.state!=4&&n.state!=0||!o?c(n.state):(o=!1,l.isCancelMode=!1,c(6)),its.notifications.publish("softwareUpdates.updateStatusChange")}function l(e){}function c(){function c(e,t){var n=its.Template.create("os-updates-template"),i=n.getBlock("Updates"),o=!1,a=[],f=[],l=NaN,c=e.length==1,d;
c?d=(e[0].title||"")+(e[0].version?" "+e[0].version:""):d=its.loc("DAHSoftwareUpdatesPage.OSUpdates.Title"),n.replaceToken("locName",its.loc("DAHSoftwareUpdatesPage.OSUpdates.Name")),n.replaceToken("locCriticalName",its.loc("DAHSoftwareUpdatesPage.OSUpdates.CriticalName")),n.replaceToken("locCriticalNamePlural",its.loc("DAHSoftwareUpdatesPage.OSUpdates.CriticalNamePlural")),n.replaceToken("locRestartRequired",its.loc("DAHSoftwareUpdatesPage.OSUpdates.RestartRequired")),n.replaceToken("locTitle",d),n.replaceToken("locCriticalTitle",its.loc("DAHSoftwareUpdatesPage.OSUpdates.CriticalTitle")),n.replaceToken("locCriticalTitlePlural",its.loc("DAHSoftwareUpdatesPage.OSUpdates.CriticalTitlePlural")),n.replaceToken("locShowAllUpdates",its.loc("DAHSoftwareUpdatesPage.OSUpdates.ShowAllUpdates")),n.replaceToken("locMore",its.loc("More")),e.each(function(n){var r='<span context-menu="hideosupdate" data-key="'+n.key+'">'+n.title+(n.version?" "+n.version:"")+"</span>";
(n.isRecommended?a:f).push(r);
var s="";
if(n.action==1||n.action==2)o=!0,e.length>1&&(n.action==1?s=its.loc("DAHSoftwareUpdatesPage.OSUpdates.RestartRequired"):s=its.loc("DAHSoftwareUpdatesPage.OSUpdates.ShutdownRequired"),s=s.replace(/ /g,"&nbsp;"),s='<span class="os-update-action">&nbsp;&mdash;&nbsp;'+s+"</span>");
var h=c?"":(n.title||"")+(n.version?" "+n.version:""),p=n.longDescription||"";
p=p.replace(u,function(e){var t=e;
return/^https?:\/\//.test(t)||(t="http://"+t),'<a href="'+t+'" target="_blank">'+e+"</a>"}),p=p.replace(/\r\n|\n|\r/g,"<br>"),p=p.replace(/\t/g,"&nbsp;&nbsp;");
var d,v;
if(t){var m=n.autoInstallWithDelayInHours;
if(m>=0){var g=new Date,y=new Date;
y.setTime(g.getTime()+m*36e5);
var b=0;
while(g.getDate()!=y.getDate())b++,g.setDate(g.getDate()+1);
if(isNaN(l)||b<l)l=b}d=" data-critical"}else d=' context-menu="hideosupdate"';
c&&(d+=" single-update");
var w;
iTunes.osUpdatesToBeInstalledAfterLogout&&E(n)?w=its.loc("DAHSoftwareInstall.Button.Restart"):w=its.loc("DAHSoftwareInstall.Button.Update"),i.replaceObjectUnescaped("update",{title:h,action:s,longDescription:p,key:n.key||"",note:v||"",extraAttributes:d||"",recommended:n.isRecommended?"true":"false",locInstallIndividualUpdate:its.loc("DAHSoftwareUpdatesPage.OSUpdates.InstallAutoIndividualUpdate",{title:h}),locUpdate:w}),i.next()});
var v,m;
n.keepBlock("RestartBlock",o),e.length>1&&(a=a.join(", "),f.length&&(a.length&&(a+="<br><br>"),n.replaceToken("locAdditionalUpdates",its.loc("DAHSoftwareUpdatesPage.OSUpdates.AdditionalUpdates")),n.replaceTokenUnescaped("stagedUpdateSummary",f),n.keepBlock("StagedUpdateSummaryBlock")),n.replaceTokenUnescaped("updateSummary",a));
var g=iTunes.softwareUpdateCatalogHostName;
g&&(n.replaceToken("locSource",its.loc("DAHSoftwareUpdatesPage.OSUpdates.Source")),n.replaceToken("catalogSource",g),n.keepBlock("CatalogSourceBlock",g));
if(t){n.keepBlock("CriticalHeader"),n.keepBlock("CriticalTitle"),n.keepBlock("CriticalCombinedButton"),n.replaceToken("locInstallAllUpdates",its.loc("DAHSoftwareUpdatesPage.OSUpdates.InstallAllCriticalUpdates")),n.replaceToken("locInstallAllCriticalUpdatesPlural",its.loc("DAHSoftwareUpdatesPage.OSUpdates.InstallAllCriticalUpdatesPlural")),n.replaceToken("locUpdate",its.loc("DAHSoftwareInstall.Button.Update"));
var y;
if(!isNaN(l)){var b="DAHSoftwareUpdatesPage.OSUpdates."+(o?"Restart":"Automatic");
l>=2?b+="NumberOfDays":l==1?b+="Tomorrow":l===0&&(b+="Today"),e.length>1&&(b+="Plural");
var w=its.loc("DAHSoftwareUpdatesPage.OSUpdates.HelpURL"),S=its.loc("DAHSoftwareUpdatesPage.OSUpdates.HelpURL.name"),x='<a class="help-link" href="'+w+'" target="_blank" aria-label="'+S+'"></a>';
y=its.loc(b,{days:l})+"&nbsp;"+x}n.keepBlock("Footer"),y&&(n.keepBlock("Note"),n.replaceTokenUnescaped("footerNote",y)),n.keepBlock("Legal"),v="#critical-os-updates",n.replaceToken("contentContainerName","critical-os-updates-content")}else{n.keepBlock("Header"),n.keepBlock("Title"),n.keepBlock("CombinedButton"),n.replaceToken("locInstallAllUpdates",its.loc("DAHSoftwareUpdatesPage.OSUpdates.InstallAllUpdates"));
var T=iTunes.osUpdatesToBeInstalledAfterLogout&&!iTunes.osUpdatesToBeInstalledAfterLogout.empty();
n.replaceToken("locUpdate",T?its.loc("DAHSoftwareInstall.Button.Restart"):its.loc("DAHSoftwareInstall.Button.Update")),n.keepBlock("Footer"),n.keepBlock("Legal"),v="#os-updates",n.replaceToken("contentContainerName","os-updates-content")}var N=!!iTunes.softwareUpdateIsSeedCatalog;
n.keepBlock("LegalAlternate",N),n.keepBlock("LegalStandard",!N),n.replaceTokenUnescaped("locSoftwareLicense",its.loc("DAHSoftwareUpdatesPage.OSUpdates.SoftwareLicense")),n.replaceTokenUnescaped("locSoftwareLicenseAlternate",its.loc("DAHSoftwareUpdatesPage.OSUpdates.SoftwareLicense.Alternate")),m=document.querySelector(v),n.compose(null,v);
var C=document.querySelector(".os-icon");
C&&(its.string.compareNumerically(its.client.osVersion(),"10.13")>=0?C.addClassName("high-sierra"):its.string.compareNumerically(its.client.osVersion(),"10.12")>=0?C.addClassName("sierra"):its.string.compareNumerically(its.client.osVersion(),"10.11")>=0?C.addClassName("elcapitan"):its.string.compareNumerically(its.client.osVersion(),"10.10")>=0?C.addClassName("yosemite"):its.string.compareNumerically(its.client.osVersion(),"10.9")>=0&&C.addClassName("mavericks"));
var k=t?s:r;
if(k===0&&e.length>1){var L=document.querySelector(v+" .all-os-updates .install-button");
L&&L.addClassName("inactive hidden")}if(e.length==1)m.classList.add("single-update"),m.classList.remove("expanded"),button=document.querySelector(v+" .installation[data-key] .install-button"),button&&button.addClassName("hidden");
else{m.classList.remove("single-update");
if(t){m.classList.add("expanded");
var A=document.querySelectorAll(v+" .installation[data-key] .install-button");
A.each(function(e){e.getAttribute("data-recommended")=="true"&&e.addClassName("hidden")})}else if(document.body.classList.contains("did-expand"))h(!0);
else{m.classList.remove("expanded");
var O=document.querySelector(v+" .all-os-updates .toggle");
O.addEventListener("click",h,!1)}document.querySelectorAll(v+" *[data-pluralized]").each(function(e){e.innerHTML=e.dataset.pluralized}),document.querySelectorAll(v+" *[data-pluralized-label]").each(function(e){e.setAttribute("aria-label",e.dataset.pluralizedLabel)})}document.querySelectorAll(v+" .install-button").each(function(e){e.addEventListener("click",p)}),setTimeout(function(){document.querySelectorAll("*[data-text-truncate-lines]").each(function(e){e.SfTextTruncate&&e.SfTextTruncate.init()})},0)}var i=document.querySelector(".no-updates");
if(!ITSOSUpdates.numUpdatesAvailable()){n>0&&(its.notifications.publish("softwareUpdates.refreshUpdatePage"),its.notifications.unsubscribe("OSUpdateCallback",b),document.querySelectorAll(".os-updates").each(function(e){e.classList.add("hidden")}),e=0,t=0,r=0,n=0),document.querySelector("#os-updates").classList.add("hidden");
return}var o=iTunes.softwareUpdateCatalogTrustLevel;
o==1?document.body.classList.add("validation"):o==2&&document.body.classList.add("untrusted");
var a,f;
f=document.querySelector("#critical-os-updates"),a=ITSOSUpdates.criticalUpdates(),a.length?(e=a.length,s=a.reduce(function(e,t){return t.isRecommended?e+1:e},0),f.classList.remove("hidden"),c(a,!0)):(e=0,s=0,f.classList.add("hidden")),f=document.querySelector("#os-updates"),a=ITSOSUpdates.noncriticalUpdates(),a.length?(t=a.length,r=a.reduce(function(e,t){return t.isRecommended?e+1:e},0),f.classList.remove("hidden"),c(a,!1)):(t=0,r=0,f.classList.add("hidden"));
var l=ITSOSUpdates.numUpdatesAvailable();
n===0&&l>0&&(document.body.removeClassName("page-not-ready"),its.notifications.publish("softwareUpdates.refreshUpdatePage"),its.notifications.subscribe("OSUpdateCallback",b)),n=l,its.kit.rebind()}function h(e){if(e){var t=document.querySelector("#os-updates .all-os-updates .install-button");
t.isCancelMode||t.addClassName("hidden"),iTunes.updateDetailsExpanded&&iTunes.updateDetailsExpanded()}document.body.classList.add("did-expand");
var n=document.getElementById("os-updates");
n.classList.add("expanded");
if(its.client.screenReaderRunning()){var r=n.querySelector(".sub-installation h2");
r.setAttribute("tabIndex","-1"),r.focus()}setTimeout(function(){n.querySelectorAll("*[data-text-truncate-lines]").each(function(e){e.SfTextTruncate&&e.SfTextTruncate.init()})},0)}function p(e){var t=e&&e.target,n=t&&t.hasAttribute("data-critical"),i=t&&t.parentBySelector("*[data-key]"),s=i&&i.getAttribute("data-key"),u=[],a=ITSOSUpdates.noncriticalUpdates();
s?(s=y(s),t.addClassName("disabled"),t.setAttribute("aria-disabled","true"),u.push(s),i.removeAttribute("context-menu"),ITSOSUpdates.activeUpdates[s.key]={critical:s.isCritical,recommended:s.isRecommended}):(n&&(a=ITSOSUpdates.criticalUpdates(),t.addClassName("disabled"),t.setAttribute("aria-disabled","true")),t.isCancelMode?u=a:u=a.filter(function(e){var t=!n&&!e.isRecommended;
if(e.key in ITSOSUpdates.activeUpdates||t&&a.length>1)return!1;
var r=document.querySelector('*[data-key="'+e.key+'"]');
return r&&r.removeAttribute("context-menu"),e.action<1&&(ITSOSUpdates.activeUpdates[e.key]={critical:e.isCritical,recommended:e.isRecommended}),!0}));
if(t.isCancelMode){d(u),o=!0;
return}var f=Object.keys(ITSOSUpdates.activeUpdates).reduce(function(e,t){var n=ITSOSUpdates.activeUpdates[t];
return!n.critical&&n.recommended&&e++,e},0);
f>=r&&m(),setTimeout(function(){iTunes.startUpdates(u,b)},0)}function d(e){e&&iTunes.cancelOSUpdates(e)}function v(e){if(e.id=="utd-os-updates")e.classList.add("hidden"),localStorage.setItem("didHideUTDIsland",1);
else{var t=e.getAttribute("data-key"),n=y(t);
n&&(n.hide(),setTimeout(function(){c()},0))}}function m(){var e=document.querySelectorAll("#os-updates .install-button");
e.each(function(e){var t=e.getAttribute("data-recommended")!=="false";
t&&(e.addClassName("disabled"),e.setAttribute("aria-disabled","true"))})}function g(e){var t=e?"#critical-os-updates":"#os-updates",n=document.querySelectorAll(t+" .os-updates .install-button");
n.each(function(e){e.innerHTML=its.loc("DAHSoftwareInstall.Button.Installed")})}function y(e){var t=iTunes.availableOSUpdates;
for(var n=0,r=t.length;
n<r;
n++)if(t[n].key==e)return t[n];
return null}function b(r){if(r.success)return;var i,s=r.update;
s?delete ITSOSUpdates.activeUpdates[s.key]:ITSOSUpdates.activeUpdates={};
if(s&&(s.isCritical?e:t)>1){i='.installation[data-key="'+s.key+'"]';
if(!s.isCritical){var u=document.querySelector("#os-updates .all-os-updates .install-button");
u.removeClassName("disabled"),u.removeAttribute("aria-disabled")}}else if(s?s.isCritical:ITSOSUpdates.areCriticalUpdatesAvailable()&&e==n)i="#critical-os-updates .all-os-updates";
else{i="#os-updates .all-os-updates";
var a=document.querySelectorAll("#os-updates .installation[data-key] .install-button");
a.each(function(e){e.removeClassName("disabled"),e.removeAttribute("aria-disabled")})}var f=document.querySelector(i+" .install-button");
f&&(f.removeClassName("disabled"),f.removeAttribute("aria-disabled"));
var l=document.querySelector(i+" .status");
l&&(l.innerHTML="");
if(r.errorCode&&r.errorCode!=-128&&r.errorCode!=105){var c=r.errorCode==3072,h=c?its.loc("DAHSoftwareInstall.Status.Error.MultipleUsers"):its.loc("DAHSoftwareInstall.Status.Error"),p=c?its.loc("DAHSoftwareInstall.Status.Error.MultipleUsers.description"):r.localizedErrorDescription+"("+r.errorCode+")";
o?its.notifications.publish("softwareUpdates.updateStatusChange"):its.client.showAlert(h,p)}}function w(e){if(typeof e.timeRemaining!="undefined"){var t="",n=e.timeRemaining?" â "+iTSInstallation.timeRemaining(e.timeRemaining):"";
return e.state==2?t=iTSInstallation.downloadProgress(e.bytesTotal,e.bytesDownloaded/e.bytesTotal):e.state==3&&(t=its.loc("DAHSoftwareInstall.Status.Installing")),iTSInstallation.progressBar(e.percentComplete)+"<br>"+t+n}return iTSInstallation.progressBar(e.percentComplete)}function E(e){var t=iTunes.osUpdatesToBeInstalledAfterLogout;
for(i=0,len=t.length;
i<len;
i++)if(t[i].key===e.key)return!0;
return!1}its.kit.onDomReady(function(){var e=document.body.getAttribute("toolbar-selection");
if(e!="updates")return;iTunes.addEventListener("osupdatescanstatuschanged",a,!1),iTunes.addEventListener("osupdatestatuschanged",f,!1),its.notifications.subscribe("softwareUpdates.updatesAdded",c),iTunes.addContextMenu&&(iTunes.addEventListener("hideosupdate",v),iTunes.addContextMenu("hideosupdate",[{title:its.loc("DAHSoftwareUpdatesPage.OSUpdates.HideUpdate"),event:"hideosupdate",alternateTitle:its.loc("DAHSoftwareUpdatesPage.OSUpdates.HideUpdate"),alternateEvent:"hideosupdate"}])),iTunes.availableOSUpdates&&c()}),ITSOSUpdates.activeUpdates={};
var e=0,t=0,n=0,r=0,s=0,o=!1,u=/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?Â«Â»ââââ]))/ig}()